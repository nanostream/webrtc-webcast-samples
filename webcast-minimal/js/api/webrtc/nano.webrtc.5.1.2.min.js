!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,i;n=[r(1),r(3),r(4),r(23),r(13)],i=function(e,t,r,n,i){"use strict";var o,a=r.getHTTPParam("debug");r.debugLevel=a&&(o=parseInt(a))?o:0,window.nanowebrtc={user:e,tools:r,const:t,audioprocess:n,version:i.webrtc.release_version,release_description:i.webrtc.release_description}}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(10),r(3),r(4),r(9),r(19),r(6),r(2),r(20),r(11),r(21),r(8)],i=function(e,t,r,n,i,o,a,s,c,d,u){"use strict";function p(){n.call(this),a.registerListener("StreamTrackEnded",this._onStreamTrackEnded.bind(this)),this._server=void 0,this._userName=void 0,this._userId=void 0,this._room=void 0,this._serverUserName=void 0,this._serverPassword=void 0,this._token=void 0,this._bintuApiKey=void 0,this._iceServers=[{urls:["stun:stun.l.google.com:19302"]},{urls:["stun:stun.nanocosmos.net:80"],username:"nano",credential:"nano"}],this._iceServersOverride=void 0,this._config={codecs:{videoCodec:"H264"},bitrates:{videoSendInitialBitrate:0,videoSendBitrate:0},sdpPatches:{preventReplaceSendReceive:!1}},this._streamProtected=!1,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._isSignedIn=!1,this._broadcaster=void 0,this._isBroadcasting=!1,this._audioMixer=new i,this._screenCaptureExtension=void 0,p.checkSupport()}var l="[RtcUser] - ",m=r.getElement,f=r.stringifyJSON,v=function(e){r.debug_(l+f(e))},h=function(e){r.warning_(l+f(e))},g=function(e){r.error_(l+f(e))},_=function(e){r.print_(l+f(e))},S=r.parseJSON,y=r.isObject,C=r.isString,E=r.isBool,b=r.isNumber,T=p.prototype=Object.create(n.prototype);return p.browserSupport={supportLevel:-1,supportText:""},p.checkSupport=function(){v("checkSupport()");var e=r.browserInfo.browser,t=parseInt(r.browserInfo.browserVersion.split(".")[0],10),n=r.browserInfo.mobile,i="Your browser: "+e+" V "+t;n&&(i+=" (mobile)");var o="Please report any issues to https://webrtc.live.",a="",s=-1;switch(v(i),e){case"Chrome":s=0,t<55&&(s=2,t<50&&(s=3));break;case"Firefox":s=0,t<50&&(s=2,t<42&&(s=3));break;case"Opera":s=0,t<42&&(s=2,t<40&&(s=3));break;case"Microsoft Edge":s=3;break;case"Safari":s=0,(t<11||n)&&(s=3);break;default:s=1}return s>0&&(a=i+"is not supported.",s>1&&(a+="You may try to use it, but it may show issues. "+o,s>2&&(a=i+"is not fully supported.",a+="You may try to use it, but it may show issues. "+o)),g(a)),p.browserSupport.supportLevel=s,p.browserSupport.supportText=a,p.browserSupport},T.signIn=function(e){v("signIn()");var t=this;if(!y(e)){var r=u.TypeNotValidError("options","Object");g(r);var n=u.composeEvent(r,"SignInError");return void t.emit(n.name,n)}return c.registerListener("SessionMessage",t._onSessionMessage.bind(t)),c.signIn(e).then(function(r){t._isSignedIn=!0,t._server=e.server,t._userName=e.userName,t._room=e.room,t._token=e.token,t._serverUserName=e.serverUserName,t._serverPassword=e.serverPassword,t._bintuApiKey=e.bintuApiKey,r.data&&r.data.iceServers&&(t._iceServers=r.data.iceServers),t._userId=r.data.userId,v("user-id: "+t._userId),t.emit("SignInSuccess",r)}).catch(function(e){"NanoError"!==e.type&&(e=u.GeneralError("Failed to sign in")),g(e);var r=u.composeEvent(e,"SignInError");t.emit(r.name,r),c.removeAllListeners()})},T.signOut=function(){v("signOut()");var e=this;c.signOut().then(function(){return e._destroy()}).then(function(){e.emit("SignOutSuccess",{})}).catch(function(t){"NanoError"!==t.type&&(t=u.GeneralError("Failed to sign out")),g(t);var r=u.composeEvent(t,"SignOutError");e.emit(r.name,r)}).then(function(){c.removeAllListeners(),e._isSignedIn=!1})},T.isSignedIn=function(){return v("isSignedIn()"),this._isSignedIn},T.setConfig=function(e){if(v("setConfig()"),v("setConfig(): "+e),!y(e)){var t=u.TypeNotValidError("config","Object"),r=u.composeEvent(t,"SetConfigError");return void this.emit(r.name,r)}if(e.codecs)if(C(e.codecs.videoCodec))this._config.codecs.videoCodec=e.codecs.videoCodec;else if("undefined"!=typeof e.codecs.videoCodec){var t=u.TypeNotValidError("config.bitrates.videoCodec","String"),r=u.composeEvent(t,"SetConfigError");this.emit(r.name,r)}if(e.bitrates){if(b(e.bitrates.videoSendInitialBitrate))this._config.bitrates.videoSendInitialBitrate=e.bitrates.videoSendInitialBitrate;else if("undefined"!=typeof e.bitrates.videoSendInitialBitrate){var t=u.TypeNotValidError("config.bitrates.videoSendInitialBitrate","Number"),r=u.composeEvent(t,"SetConfigError");this.emit(r.name,r)}if(b(e.bitrates.videoSendBitrate))this._config.bitrates.videoSendBitrate=e.bitrates.videoSendBitrate;else if("undefined"!=typeof e.bitrates.videoSendBitrate){var t=u.TypeNotValidError("config.bitrates.videoSendBitrate","Number"),r=u.composeEvent(t,"SetConfigError");this.emit(r.name,r)}}if(e.sdpPatches)if(E(e.sdpPatches.preventReplaceSendReceive))this._config.sdpPatches.preventReplaceSendReceive=e.sdpPatches.preventReplaceSendReceive;else{var t=u.TypeNotValidError("config.sdpPatches.preventReplaceSendReceive","Bool"),r=u.composeEvent(t,"SetConfigError");this.emit(r.name,r)}},T.setIceServers=function(e){v("setIceServers()"),this._iceServersOverride=e},T.checkServer=function(e){v("checkServer()");var t=this;c.status().then(function(e){t.emitSimple("ReceivedServerStats",{stats:S(e.data)||{error:{message:"Could not parse response from server",code:-1,userinfo:null}}})}).catch(function(e){g(e)})},T.enableStats=function(e,t){v("enableStats()"),this._statsEnabled="undefined"==typeof e||e,this._statsIntervalTime=t||1e3},T.startBroadcast=function(t){_("startBroadcast()");var r=this;if(!r.isSignedIn()){var n=u.NotSignedInError(),i=u.composeEvent(n,"StartBroadcastError");return void this.emit(i.name,i)}if(this._broadcaster){var n=u.WrongStateError("Already broadcasting"),i=u.composeEvent(n,"StartBroadcastError");return void this.emit(i.name,i)}this._broadcaster=new e(this._userName,this._userId,this._room),this._broadcaster.setConfig(this._config);var o=this._iceServersOverride||this._iceServers;this._broadcaster.setIceServers(o),this._broadcaster.enableStats(this._statsEnabled,this._statsIntervalTime),this._listenToBroadcaster(this._broadcaster);var s=a.getLocalMedias()[0],c=s.metadata,d=s.stream;t.transcodingTargets.videowidth=c.width,t.transcodingTargets.videoheight=c.height,this._broadcaster.setTranscodingSettings(t.transcodingTargets),this._broadcaster.addStream(d),this._broadcaster.start().then(function(e){r._streamProtected=!0,r.emit("StartBroadcastSuccess",{data:{streamname:e}})}).catch(function(e){r._streamProtected=!!r._chatRoom&&(!!r._chatRoom.getUsersCount()||!1),"NanoError"!==e.type&&(e=u.GeneralError("Failed to start broadcast")),g(e);var t=u.composeEvent(e,"StartBroadcastError");r.emit(t.name,t)})},T.stopBroadcast=function(){v("stopBroadcast()");var e=this,t=e._broadcaster;if(e._broadcaster=void 0,t)t.stop().catch(function(t){"NanoError"!==t.type&&(t=u.GeneralError("Failed to stop broadcast")),g(t);var r=u.composeEvent(t,"StopBroadcastError");e.emit(r.name,r)}).then(function(){e._isBroadcasting=!1,e._streamProtected=!!e._chatRoom&&(!!e._chatRoom.getUsersCount()||!1),e.emit("StopBroadcastSuccess",{})});else{var r=u.StopBroadcastError("No broadcast is running"),n=u.composeEvent(r);e.emit(n.name,n)}},T.sendMetaData=function(e,t){v("sendMetaData()");var r=this;if(!C(e)){var n=u.TypeNotValidError("handlerName","String"),i=u.composeEvent(n,"Error");return void this.emit(i.name,i)}if(!y(t)){var n=u.TypeNotValidError("jsonValues","Object"),i=u.composeEvent(n,"Error");return void this.emit(i.name,i)}if(this._isBroadcasting){var o=this._channels.getBroadcaster();o.sendMetaData(e,t).catch(function(e){"NanoError"!==e.type&&(e=u.GeneralError("Failed to send metadata")),g(e);var t=u.composeEvent(e,"Error");r.emit(t.name,t)})}else{var n=u.WrongStateError("Not broadcasting"),i=u.composeEvent(n,"Error");this.emit(i.name,i)}},T.enterRoom=function(e){v("enterRoom()");var t,r,n=this;if(!n.isSignedIn())return t=u.NotSignedInError(),r=u.composeEvent(t,"EnterRoomError"),void this.emit(r.name,r);if(n._chatRoom)return t=u.WrongStateError("Already in room"),r=u.composeEvent(t,"EnterRoomError"),void this.emit(r.name,r);if(!y(e))return t=u.TypeNotValidError("roomOptions","Object"),r=u.composeEvent(t,"EnterRoomError"),void n.emit(r.name,r);if(!C(e.userName))return t=u.TypeNotValidError("roomOptions.userName","String"),r=u.composeEvent(t,"EnterRoomError"),void n.emit(r.name,r);if(!C(e.room))return t=u.TypeNotValidError("roomOptions.room","String"),r=u.composeEvent(t,"EnterRoomError"),void n.emit(r.name,r);e.userId=n._userId,n._chatRoom=new d(e),n._chatRoom.setConfig(n._config);var i=this._iceServersOverride||this._iceServers;n._chatRoom.setIceServers(i),n._chatRoom.on("RoomUpdate",n._onRoomUpdate.bind(n)),n._chatRoom.on("RemoteStreamAdded",n._onRemoteStreamAdded.bind(this)),n._chatRoom.enter().then(function(e){n.emit("EnterRoomSuccess",{})}).catch(function(e){"NanoError"!==e.type&&(e=u.GeneralError("Failed to enter room"));var t=u.composeEvent(e,"EnterRoomError");n.emit(t.name,t),n._chatRoom.removeEvent("RoomUpdate"),n._chatRoom=void 0})},T.leaveRoom=function(e){v("leaveRoom()");var t=this;if(!t._chatRoom){var r=u.ObjectNotExistError("_chatRoom","String"),n=u.composeEvent(r,"LeaveRoomError");return void t.emit(n.name,n)}t._chatRoom.removeEvent("RoomUpdate"),t._chatRoom.leave().then(function(e){t.emit("LeaveRoomSuccess",{})}).catch(function(e){"NanoError"!==e.type&&(e=u.GeneralError("Failed to leave room"));var r=u.composeEvent(e,"LeaveRoomError");t.emit(r.name,r)}).then(function(){t._chatRoom=void 0})},T.invokeCall=function(e){v("invokeCall()");var t=this;if(!t._chatRoom){var r=u.ObjectNotExistError("_chatRoom","String"),n=u.composeEvent(r,"InvokeCall");return void t.emit(n.name,n)}if(!C(e)){r=u.TypeNotValidError("remoteUserId","String");var n=u.composeEvent(r,"InvokeCall");return void t.emit(n.name,n)}t._chatRoom.callUser(e).then(function(){t._streamProtected=!0}).catch(function(e){t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting,"NanoError"!==e.type&&(e=u.GeneralError("Failed to invoke call"));var r=u.composeEvent(e,"InvokeCall");t.emit(r.name,r)})},T.hangUpCall=function(e){v("hangUpCall()");var t=this;if(!t._chatRoom){var r=u.ObjectNotExistError("_chatRoom","String"),n=u.composeEvent(r,"HangUpCall");return void t.emit(n.name,n)}if(!C(e)){r=u.TypeNotValidError("remoteUserId","String");var n=u.composeEvent(r,"HangUpCall");return void t.emit(n.name,n)}t._chatRoom.hangUpCall(e).then(function(){t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting}).catch(function(e){t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting,"NanoError"!==e.type&&(e=u.GeneralError("Failed to hang up call"));var r=u.composeEvent(e,"HangUpCall");t.emit(r.name,r)})},T.answerCall=function(e){v("answerCall()");var t=this;if(!t._chatRoom){var r=u.ObjectNotExistError("_chatRoom","String"),n=u.composeEvent(r,"AnswerCall");return void t.emit(n.name,n)}if(!C(e)){r=u.TypeNotValidError("remoteUserId","String");var n=u.composeEvent(r,"AnswerCall");return void t.emit(n.name,n)}t._chatRoom.answerCall(e).then(function(){t._streamProtected=!0}).catch(function(e){t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting,"NanoError"!==e.type&&(e=u.GeneralError("Failed to answer call")),g(e);var r=u.composeEvent(e,"AnswerCall");t.emit(r.name,r)})},T.declineCall=function(e){v("declineCall()");var t=this;if(!t._chatRoom){var r=u.ObjectNotExistError("_chatRoom","String"),n=u.composeEvent(r,"DeclineCall");return void t.emit(n.name,n)}if(!C(e)){r=u.TypeNotValidError("remoteUserId","String");var n=u.composeEvent(r,"DeclineCall");return void t.emit(n.name,n)}t._chatRoom.declineCall(e).then(function(){console.log()}).catch(function(e){"NanoError"!==e.type&&(e=u.GeneralError("Failed to decline call")),g(e);var r=u.composeEvent(e,"DeclineCall");t.emit(r.name,r)})},T.addScreenCaptureExtension=function(e){v("addScreenCaptureExtension()");var t=r.browserInfo.browser;if("Microsoft Edge"===t)return void h("Screen capture for Microsoft Edge is not supported");e=C(e)?e:"nanoScreenCapture",this._screenCaptureExtension=new s(e);var n=o.addScreenCaptureDevice(e);n.length>0&&(n.updated=!0,this.emitSimple("ReceivedDeviceList",n))},T.isScreenCaptureAvailable=function(){return v("isScreenCaptureAvailable()"),!!this._screenCaptureExtension&&this._screenCaptureExtension.isScreenCaptureAvailable()},T.getDevices=function(){v("getDevices()"),o.enumerateDevices().then(this._getDevicesSuccess.bind(this)).catch(this._getDevicesError.bind(this))},T.setVideoDevice=function(e){if(v("setVideoDevice()"),this._streamProtected){var t=u.WrongStateError("Stream is already in use"),r=u.composeEvent(t,"SetVideoDeviceError");return void this.emit(r.name,r)}o.setDevice("videoinput",e)},T.setAudioDevice=function(e){if(v("setAudioDevice()"),this._streamProtected){var t=u.WrongStateError("Stream is already in use"),r=u.composeEvent(t,"SetAudioDeviceError");return void this.emit(r.name,r)}o.setDevice("audioinput",e)},T.getSelectedVideoDevice=function(){if(v("getSelectedVideoDevice()"),this._streamProtected){var e=u.WrongStateError("Stream is already in use"),t=u.composeEvent(e,"GetSelectedVideoDeviceError");return void this.emit(t.name,t)}return o.getDevice("videoinput")},T.getSelectedAudioDevice=function(){if(v("getSelectedAudioDevice()"),this._streamProtected){var e=u.WrongStateError("Stream is already in use"),t=u.composeEvent(e,"GetSelectedAudioDeviceError");return void this.emit(t.name,t)}return o.getDevice("audioinput")},T.startPreview=function(e){if(v("startPreview()"),this._streamProtected){var t=u.WrongStateError("Stream is already in use"),r=u.composeEvent(t,"StartPreviewError");return void this.emit(r.name,r)}var n=this;if(!y(e)){var t=u.TypeNotValidError("config","Object"),r=u.composeEvent(t,"StartPreviewError");return void this.emit(r.name,r)}if(!y(e.videoDeviceConfig)){var t=u.TypeNotValidError("config.videoDeviceConfig","Object"),r=u.composeEvent(t,"StartPreviewError");return void this.emit(r.name,r)}if(!y(e.audioDeviceConfig)){var t=u.TypeNotValidError("config.audioDeviceConfig","Object"),r=u.composeEvent(t,"StartPreviewError");return void this.emit(r.name,r)}var i=e.videoDeviceConfig,o=e.audioDeviceConfig,a=e.elementId,s=!!e.useWebView;this.setVideoDevice(i),this.setAudioDevice(o),this._getStream(s,!1).then(function(e){if(e&&e.stream&&e.stream.data&&e.stream.data.stream){var t=e.stream.data.stream;a&&(m(a).srcObject=t),e.name="StartPreviewSuccess",n.emit(e.name,e.stream),e.devices&&(e.name="ReceivedDeviceList",n.emit(e.name,e.devices))}}).catch(function(e){"NanoError"!==e.type&&(e=u.GeneralError("Failed to start preview"));var t=u.composeEvent(e,"StartPreviewError");n.emit(t.name,t)})},T.stopPreview=function(){if(v("stopPreview()"),this._streamProtected){var e=u.WrongStateError("Stream is already in use"),t=u.composeEvent(e,"StopPreviewError");return void this.emit(t.name,t)}var r=this;a.removeLocalMedias().then(function(e){null===e.data.stream&&(e.name="StopPreviewSuccess",r.emit(e.name,e))}).catch(function(e){"NanoError"!==e.type&&(e=u.GeneralError("Failed to stop preview"));var t=u.composeEvent(e,"StopPreviewError");r.emit(t.name,t)})},T.muteVideo=function(e){v("muteVideo()"),a.muteVideoTracks(e)},T.muteAudio=function(e){v("muteAudio()"),a.muteAudioTracks(e)},T.injectExternalMediaStream=function(e){return v("injectExternalMediaStream()"),e&&e.stream?r.isArray(e.tracks)&&e.tracks.length?this._streamProtected?Promise.reject(new Error("Cant inject, stream is already beeing used")):e.tracks.indexOf("audio")!==-1?this._mixExternalAudio(e.stream):Promise.reject(new Error('Mixing in tracks other than "audio" is not supported at the moment')):Promise.reject(new Error("Parameter config.tracks must contain an array with track types to be replaced")):Promise.reject(new Error("You need to provide a stream config object"))},T._listenToBroadcaster=function(e){e.on("BroadcastStatus",this._onBroadcastStatus.bind(this)),e.on("ReceivedWebRTCStats",this._onReceivedWebRTCStats.bind(this))},T._getStream=function(e,t,r){var n=this;return Promise.resolve().then(function(){return t?o.enumerateDevices():Promise.resolve()}).then(function(t){if(t&&t.data){if(!t.data.updated)return Promise.reject(r);n._getDevicesSuccess(t)}var i=o.getDevice("videoinput"),s=o.getDevice("audioinput"),c={videoinput:i,audioinput:s};return a.getMediaForDevices(c,e)}).catch(function(r){return"OverconstrainedError"===r.name&&r.userinfo&&"deviceId"===r.userinfo.constraint&&r.userinfo.retry&&!t?n._getStream(e,!0,r):Promise.reject(r)})},T._mixExternalAudio=function(e){if(!e)return Promise.reject(new Error("No external stream passed"));var t,r,n=this;return Promise.resolve(a.getLocalMedias()[0]).then(function(e){if(e&&e[0])return e[0];throw new Error("No local stream")}).then(function(e){if(t=e,r=t.getAudioTracks(),r.length>0)return n._audioMixer.connect(t,0);throw new Error("Local stream has no audio")}).then(function(){return n._audioMixer.connect(e,1)}).then(function(){return n._audioMixer.getOutputStream()}).then(function(e){var n=r[0],i=e.getAudioTracks(),o=i[0];t.removeTrack(n),t.addTrack(o)}).catch(function(e){throw g("Could not mix audioTracks - error: "+e),e})},T._destroy=function(){v("destroy()");var e=this;e._isSignedIn=!1,e._broadcaster&&e._broadcaster.stop().catch(function(e){v(e)}).then(function(){e._broadcaster=void 0}),e._chatRoom&&e._chatRoom.destroy().catch(function(e){v(e)}).then(function(){e._chatRoom=void 0})},T._emitError=function(e,t){this.emitSimple("Error",{error:e,originalError:t|e})},T._onBroadcastStatus=function(e){var r={};switch(r.name="BroadcastStatus",e.data.state){case t.BROADCAST_STATE.INITIALIZED:case t.BROADCAST_STATE.STARTED:case t.BROADCAST_STATE.SIGNALING:case t.BROADCAST_STATE.CONNECTED:case t.BROADCAST_STATE.RECONNECTING:case t.BROADCAST_STATE.DISCONNECTED:r.data=e.data;break;case t.BROADCAST_STATE.BROADCASTING:r.data=e.data,this._isBroadcasting=!0;break;case t.BROADCAST_STATE.FAILED:this._isBroadcasting?(r.name="BroadcastError",r.error=u.BroadcastError("Unknown reason")):(r.name="StartBroadcastError",r.error=u.StartBroadcastError("Unknown reason")),this._isBroadcasting=!1,this._broadcaster.destroy(),this._broadcaster=void 0}this.emit(r.name,r)},T._onRemoteStreamAdded=function(e){e.data.stream&&"default"===e.data.stream.id;for(var t=this,r=a.getRemoteMedias(),n=0;n<r.length;n++){var i=r[n];if(i.stream.id===e.data.stream)return void t.emit("CallActive",{data:i})}e.name="RemoteStreamError",t.emit(e.name,e)},T._onReceivedWebRTCStats=function(e){this.emit(e.name,e)},T._onSessionMessage=function(e){v("_onSessionMessage()"),v("_onSessionMessage(): "+e);var t=this;switch(e.type){case"close":if(t._destroy(),"disconnect"===e.reason){var r=u.ServerError("disconnect");g(r);var n=u.composeEvent(r,"ServerError");t.emit(n.name,n)}}},T._onRoomUpdate=function(e){switch(v(e),e.type){case"room_update":this.emit("PeerListUpdated",{data:e.data});break;case"call_incoming":this.emit("CallIncoming",{data:e.data});break;case"call_declined":this.emit("CallDeclined",{data:e.data})}},T._onStreamTrackEnded=function(e){v("RTC: MediaStream Event: "+e.type),this.emit("StreamTrackEnded",e)},T._getDevicesSuccess=function(e){this.emitSimple("ReceivedDeviceList",e.data)},T._getDevicesError=function(e){var t=e.data.error.message||e.data.error.toString();g(t)},p}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(3),r(4),r(5),r(6),r(8),r(9)],i=function(e,t,r,n,i,o){"use strict";var a=t.debug_,s=t.error_,c=t.isBool,d=t.isFunction,u={_medias:{local:[],remote:[]},_constraints:{},_elements:{video:void 0,audio:void 0},_error:void 0,_eventEmitter:new o};return u.registerListener=function(e,t){u._eventEmitter.on(e,t)},u.removeEvent=function(e,t){u._eventEmitter.removeEvent(e)},u.removeAllListeners=function(){u._eventEmitter.removeAllListeners()},u.getMediaForDevices=function(t,r){var o=void 0;return new Promise(function(a,d){return u._verifyDevicesExistence(t).then(function(){return o=t.videoinput.videoDeviceConfig?t.videoinput.videoDeviceConfig.source:c(t.videoinput)?e.MEDIA_SOURCES.CAMERA:void 0,u._verifySourceValidity(o)}).then(function(){return n.composeConstraints(t)}).then(function(e){return u._constraints=e,u._getMedia(o,e)}).then(function(e){var t=e.data.stream;u._error=void 0,u._reenumerateDevices(r).then(function(o){if(t)return n.updateSelected(t,r),a({stream:e,devices:o});var c=n._selected.videoinput,u=n._selected.audioinput;if(c!==!1||u!==!1){var p=i.MediaStreamNotFoundError(),l=i.composeEvent(p),m="MediaController: getMediaForDevices: "+JSON.stringify(p);return s(m),d(l)}})}).catch(function(e){var t=i.composeEvent(e),r="MediaController: getMediaForDevices: "+JSON.stringify(e);return s(r),d(t)})})},u.addLocalMedia=function(e){var t=new r(e),n=t.kind;return u._medias[n].push(t),Promise.resolve(t)},u.addRemoteMedia=function(e){var t=new r(e),n=t.kind;return u._medias[n].push(t),u._setupMedia(t)},u.removeMedia=function(e){for(var t=u.getLocalMedias(),r=0;r<t.length;r++){var n=t[r];n.stream.id===e&&(n.unbind(),t.splice(r,1))}for(var i=u.getRemoteMedias(),r=0;r<i.length;r++){var o=i[r];o.stream.id===e&&(o.unbind(),i.splice(r,1))}},u.removeRemoteMedias=function(){for(var e=u._medias.remote,t=0;t<e.length;t++){var r=e[t];r.unbind(),e.splice(t,1)}if(0==e.length)return Promise.resolve({data:{}});var n=i.MediaStreamNotRemovedError(),o="MediaController: removeRemoteMedias: "+JSON.stringify(n);return s(o),Promise.reject(n)},u.removeLocalMedias=function(){for(var e=u._medias.local,t=0;t<e.length;t++){var r=e[t];r.unbind(),e.splice(t,1)}if(0==e.length)return Promise.resolve({data:{stream:null}});var n=i.MediaStreamNotRemovedError(),o=i.composeEvent(n),a="MediaController: removeLocalMedias: "+JSON.stringify(n);return s(a),Promise.reject(o)},u.getLocalMedias=function(){return u._medias.local},u.getRemoteMedias=function(){return u._medias.remote},u.muteVideoTracks=function(e){u._muteTracks("videoinput",e)},u.muteAudioTracks=function(e){u._muteTracks("audioinput",e)},u._getMedia=function(t,r){var n=this;return u._verifySourceValidity(t).then(function(){return u._getReadyForMedia()}).then(function(){return t===e.MEDIA_SOURCES.CAMERA?u._getUserMedia(r):t===e.MEDIA_SOURCES.SCREEN?u._getDisplayMedia(r):void 0}).then(function(e){return u.addLocalMedia(e)}).then(function(e){return e.bind(n),u._setupMedia(e)}).catch(function(e){var t="MediaController: _getMedia: "+JSON.stringify(e);return s(t),Promise.reject(e)})},u._getUserMedia=function(e){return u._verifyGetUserMediaExistence().then(function(t){return t.getUserMedia(e)}).then(function(e){return Promise.resolve({stream:e,kind:"local"})}).catch(function(e){if(!e){var t=i.ObjectNotExistError("error","Error"),r="MediaController: _getUserMedia: "+JSON.stringify(t);return s(r),Promise.reject(t)}if("NanoError"===e.type){var r="MediaController: _getUserMedia: "+JSON.stringify(e);return s(r),Promise.reject(e)}var n=!u._error||u._error&&"OverconstrainedError"!==u._error.name,t=i.GetUserMediaError(e,n);u._error=t;var r="MediaController: _getUserMedia: "+JSON.stringify(t);return s(r),Promise.reject(t)})},u._getDisplayMedia=function(e){var r="Chrome"===t.browserInfo.browser;return u._verifyGetDisplayMediaExistence().then(function(t){return t.getDisplayMedia({video:e.video,audio:!r&&e.audio})}).then(function(t){return r&&e.audio?u._getUserMedia({video:!1,audio:e.audio}).then(function(e){return u._addAudioToStream(e,t)}):t}).then(function(e){return Promise.resolve({stream:e,kind:"local"})}).catch(function(e){if(!e){var t=i.ObjectNotExistError("error","Error"),r="MediaController: _getDisplayMedia: "+JSON.stringify(t);return s(r),Promise.reject(t)}if("NanoError"===e.type){var r="MediaController: _getDisplayMedia: "+JSON.stringify(e);return s(r),Promise.reject(e)}var t=i.GetUserMediaError(e),r="MediaController: _getDisplayMedia: "+JSON.stringify(t);return s(r),Promise.reject(t)})},u._getReadyForMedia=function(){var e=u.getLocalMedias(),t=e[0];return t&&u.removeMedia(t.stream.id),Promise.resolve()},u._setupMedia=function(t){return new Promise(function(r,n){var o=t.getVideoTracks(),a=t.getAudioTracks();if(!o&&!a){var c=i.MediaStreamTrackError(),d="MediaController: _setupMedia: "+JSON.stringify(c);return s(d),n(c)}for(var p=[].concat(o).concat(a),l=!0,m=0;m<p.length;m++){var f=p[m];if(f.readyState&&(!l||"live"!==f.readyState)){l=!1;var c=i.DeviceBlockedError(f.kind,f.label),d="MediaController: _setupMedia: "+JSON.stringify(c);return s(d),n(c)}}var v=o.length?e.ELEMENT_TYPES.VIDEO:a.length?e.ELEMENT_TYPES.AUDIO:void 0;u._createElement(v,t).then(function(e){return r(e)}).catch(function(e){var t="MediaController: _setupMedia: "+JSON.stringify(e);return s(t),n(e)})})},u._createElement=function(t,r){return u._verifyElementKindValidity(t).then(function(){return new Promise(function(n,i){switch(t){case e.ELEMENT_TYPES.VIDEO:var o=document.createElement(e.ELEMENT_TYPES.VIDEO);u._elements.video=o,o.addEventListener("canplay",function(){u._onMetadata(r,o).then(function(e){return n(e)}).catch(function(e){var t="MediaController: _createElement: "+JSON.stringify(e);return"ReceiveMetadataError"===e.name?a(t):s(t),i(e)})}),o.autoplay=!0,o.setAttribute("playsinline",""),o.muted=!0,o.srcObject=r.stream;break;case e.ELEMENT_TYPES.AUDIO:var c=document.createElement(e.ELEMENT_TYPES.AUDIO);u._elements.audio=c,c.onloadedmetadata=function(){u._onMetadata(r,c).then(function(e){return n(e)}).catch(function(e){var t="MediaController: _createElement: "+JSON.stringify(e);return"ReceiveMetadataError"===e.name?a(t):s(t),i(e)})},c.autoplay=!0,c.muted=!0,c.srcObject=r.stream}})}).catch(function(e){var t="MediaController: _setupMedia: "+JSON.stringify(e);return s(t),Promise.reject(e)})},u._removeElement=function(e){var t=u._elements;t[e]&&(t[e].src="",t[e]=void 0)},u._muteTracks=function(e,t){var r=u.getLocalMedias()[0];r&&r.muteTracks(e,t)},u._composeMetadata=function(e,t){if(!e){var r=i.ObjectNotExistError("media","Media"),n="MediaController: _composeMetadata: "+JSON.stringify(r);return s(n),Promise.reject(r)}if(!t){var r=i.ObjectNotExistError("element","HTMLVideoElement"),n="MediaController: _composeMetadata: "+JSON.stringify(r);return s(n),Promise.reject(r)}var o=e.metadata;if(o)return o.hasVideo=e.hasVideoTracks(),o.hasAudio=e.hasAudioTracks(),o.width=t.videoWidth||0,o.height=t.videoHeight||0,e.gotMetadata=!0,Promise.resolve({data:{stream:e.stream,metadata:o,constraints:u._constraints}});var r=i.ObjectNotExistError("metadata","Metadata"),n="MediaController: _composeMetadata: "+JSON.stringify(r);return s(n),Promise.reject(r)},u._addAudioToStream=function(e,t){if(!e){var r=i.ObjectNotExistError("audio","MediaStream"),n="MediaController: _addAudioToStream: "+JSON.stringify(r);return s(n),Promise.reject(r)}if(!t){var r=i.ObjectNotExistError("streamInfo","MediaStream"),n="MediaController: _addAudioToStream: "+JSON.stringify(r);return s(n),Promise.reject(r)}var o=e.stream.getAudioTracks(),a=o[0];return t.addTrack(a),Promise.resolve(t)},u._reenumerateDevices=function(e){return n.shouldReenumerate(e)?n.enumerateDevices():Promise.resolve()},u._verifyDevicesExistence=function(e){if(!e){var t=i.ObjectNotExistError("devices","Array"),r="MediaController: _verifyDevicesExistence: "+JSON.stringify(t);return s(r),Promise.reject(t)}if(!e.videoinput&&!e.audioinput){var t=i.DevicesNotFoundError(),r="MediaController: _verifyDevicesExistence: "+JSON.stringify(t);return s(r),Promise.reject(t)}return Promise.resolve()},u._verifySourceValidity=function(t){if(e.MEDIA_SOURCES.containsValue(t))return Promise.resolve();var r=i.EnumValueNotValidError(t,e.MEDIA_SOURCES),n="MediaController: _verifySourceValidity: "+JSON.stringify(r);return s(n),Promise.reject(r)},u._verifyElementKindValidity=function(t){if(e.ELEMENT_TYPES.containsValue(t))return Promise.resolve();var r=i.EnumValueNotValidError(t,e.ELEMENT_TYPES),n="MediaController: _verifyElementKindValidity: "+JSON.stringify(r);return s(n),Promise.reject(r)},u._verifyMetadataReceivedOnce=function(e){return e.gotMetadata?Promise.reject(i.ReceiveMetadataError()):Promise.resolve()},u._verifyElementHasVideo=function(e,t){if(!e){var r=i.ObjectNotExistError("media","Media"),n="MediaController: _verifyElementHasVideo: "+JSON.stringify(r);return s(n),Promise.reject(r)}if(!t){var r=i.ObjectNotExistError("element","HTMLVideoElement"),n="MediaController: _verifyElementHasVideo: "+JSON.stringify(r);return s(n),Promise.reject(r)}if(t.videoWidth&&t.videoHeight&&(0<t.videoWidth&&t.videoWidth<10||0<t.videoHeight&&t.videoHeight<10)){var o=e.getVideoTracks(),a=o[0],r=i.DeviceBlockedError(a.kind,a.label),n="MediaController: _verifyElementHasVideo: "+JSON.stringify(r);return s(n),Promise.reject(r)}return Promise.resolve()},u._verifyElementHasAudio=function(e,t){if(!e){var r=i.ObjectNotExistError("media","Media"),n="MediaController: _verifyElementHasAudio: "+JSON.stringify(r);return s(n),Promise.reject(r)}if(!t){var r=i.ObjectNotExistError("element","HTMLVideoElement"),n="MediaController: _verifyElementHasAudio: "+JSON.stringify(r);return s(n),Promise.reject(r)}if(t.duration&&t.duration!==1/0||t.ended||t.error){var o=e.getAudioTracks(),a=o[0],r=i.DeviceBlockedError(a.kind,a.label),n="MediaController: _verifyElementHasAudio: "+JSON.stringify(r);return s(n),Promise.reject(r)}return Promise.resolve()},u._verifyGetUserMediaExistence=function(){var e=navigator.mediaDevices;if(!e||!d(e.getUserMedia)){var t=i.FunctionNotDefinedError("getUserMedia"),r="MediaController: _verifyGetUserMediaExistence: "+JSON.stringify(t);return s(r),Promise.reject(t)}return Promise.resolve(e)},u._verifyGetDisplayMediaExistence=function(){var e=navigator.mediaDevices;if(!e||!d(e.getDisplayMedia)){var t=i.FunctionNotDefinedError("getDisplayMedia"),r="MediaController: _verifyGetDisplayMediaExistence: "+JSON.stringify(t);return s(r),Promise.reject(t)}return Promise.resolve(e)},u._onMetadata=function(e,t){return u._verifyMetadataReceivedOnce(e).then(function(){return u._verifyElementHasVideo(e,t)}).then(function(){return u._verifyElementHasAudio(e,t)}).then(function(){return u._composeMetadata(e,t)}).then(function(e){return u._removeElement("video"),u._removeElement("audio"),Promise.resolve(e)}).catch(function(e){if("ReceiveMetadataError"!==e.name){var t="MediaController: _onMetadata: "+JSON.stringify(e);s(t)}return Promise.reject(e)})},u._onTrackEnded=function(e){console.log("StreamTrackEnded"),u._eventEmitter.emit("StreamTrackEnded",{track:e.target.kind,type:e.type,device:e.target.label})},u}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(4)],i=function(e){"use strict";var t=e.isFunction,r={STREAM_NOMEDIASTREAM:1,STREAM_ACTIVE:2,STREAM_INACTIVE:3,STREAM_ENDED:4,MEDIA_SOURCES:{CAMERA:"camera",SCREEN:"screen",containsValue:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]===e)return!0;return!1},toString:function(){var e=[];for(var r in this)if(this.hasOwnProperty(r)){var n=this[r];t(n)||e.push(this[r])}return e.join()}},ELEMENT_TYPES:{VIDEO:"video",AUDIO:"audio",containsValue:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]===e)return!0;return!1},toString:function(){var e=[];for(var r in this)if(this.hasOwnProperty(r)){var n=this[r];t(n)||e.push(this[r])}return e.join()}},BROADCAST_STATE:{IDLE:1,INITIALIZED:2,STARTED:3,SIGNALING:4,CONNECTED:5,BROADCASTING:6,RECONNECTING:7,DISCONNECTED:8,FAILED:9,STOPPED:10},CHATPEER_STATE:{IDLE:1,INITIALIZED:2,SIGNALING:3,SIGNALLING_DONE:4,CALLING:5,NEGOTIATION_NEEDED:7,DISCONNECTED:8,FAILED:9,STOPPED:10}};return r}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[],i=function(){"use strict";var e=Math.floor,t=Math.random,r={browserInfo:void 0,HTTPParams:void 0,logTime:!0,debugLevel:0,debugCount:0,debugMax:30,ELEMENT_DEBUG:"debug",ELEMENT_MESSAGES:"messages",ELEMENT_ERRORS:"errors"};return r.parseJSON=function(e,t,n){if("object"==typeof e)return e;try{return JSON.parse(e,t)}catch(t){r.error_("Error:"+t+" parsing from json: "+e,n);
}},r.stringifyJSON=function(e,t,n,i){if(r.isString(e))return e;try{return JSON.stringify(e,t,n)}catch(t){r.error_("Error:"+t+" stringifying to json: "+e,i)}},r.getHTTPParam=function(e){var t,n;if(!r.HTTPParams){r.HTTPParams=[];var i=document.location.search.substr(1,document.location.search.length),o=document.location.href;if(""===i&&o.indexOf("?")!==-1&&(i=o.slice(o.indexOf("?")+1)),""!==i)for(i=i.split("&"),t=0,n=i.length;t<n;t++){var a=i[t].split("="),s=a[0],c=a.length>1?a[1]:"";r.HTTPParams[unescape(s)]=unescape(c)}}return r.HTTPParams[e]},r.encodeURIComponent=function(e,t){return r.isString(e)?decodeURIComponent(e)===e?encodeURIComponent(e):e:void r.error_("Error: could not uri encode: "+e+"(must be of type string)",t)},r.getElement=function(e){var t=document.getElementById(e);return t?t:(r.debug_("DOM element not found "+e),{value:void 0,checked:void 0,enabled:void 0,textContent:void 0,options:{length:0},style:{},innerHTML:"",src:"",classList:"",click:function(){return null},show:function(){return null},hide:function(){return null},removeChild:function(){return null}})},r.elementExists=function(e){return!!document.getElementById(e)},r.showElement=function(e,t){var n=r.getElement(e);n&&(t||"undefined"==typeof t?n.style.display="block":n.style.display="none")},r.disableElement=function(e){var t=r.getElement(e);t&&(r.getElement(e).disabled=!0)},r.print_=function(e){r._log(e,"messages")},r.success_=function(e){r._log(e,"messages","green")},r.warning_=function(e){r._log(e,"messages","orange")},r.error_=function(e,t){t||(t=1),r._log(e,r.ELEMENT_MESSAGES,"red"),r._log(e,r.ELEMENT_ERRORS,"red",t)},r.debug_=function(e){0!==r.debugLevel&&r._log(e,r.ELEMENT_DEBUG)},r._log=function(e,t,n,i){r.isObject(e)&&(e=r.stringifyJSON(e,null," "));var o="";if(r.logTime&&window.performance){var a=(window.performance.now()/1e3).toFixed(3);o=a+": "}switch(n){case"green":e="Success: "+e;break;case"orange":e="Warning: "+e;break;case"red":e="Error: "+e;break;default:n=""}n?console.log("%c"+e,"color:"+n):console.log(e);var s=document.getElementById(t);if(s&&(t===r.ELEMENT_DEBUG&&r.debugCount>r.debugMax&&(s.removeChild(s.firstChild),r.debugCount++),s.innerHTML+="<span"+(n?' style="color:'+n+';">':">")+e+"</span><br>"),i>1)throw new Error(e)},r.contains=function(e,t){var r,n,i=0,o=0,a=t.split("*");for(r=0,n=a.length;r<n;r++)0!==a[r].length&&(o++,e.indexOf(a[r])!==-1&&i++);return i===o},r.isBool=function(e){return e===!0||e===!1},r.isIntString=function(e){return r.isString(e)&&r.isInt(Number(e))},r.isNumber=function(e){return Number(e)===e&&isFinite(e)},r.isInt=function(e){return e===Number(e)&&e%1===0},r.isUint=function(e){return e===Number(e)&&e%1===0&&e>=0},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isFunction=function(e){return"function"==typeof e},r.isObject=function(e){return!!e&&e.constructor!==Array&&("object"==typeof e||e instanceof Object)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.getRandomUint=function(n){return n=r.isUint(n)?n:10,e(t()*n)},r.getRandomString=function(e,t){var n,i,o,a,s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",c="0123456789abcdefghijklmnopqrstuvwxyz",d="0123456789";switch(e){case 0:a=d;break;case 1:a=c;break;case 2:a=s;break;default:a=c}var u="",p=r.getRandomUint;for(n=0,i=r.isUint(t)?t:6,o=a.length;n<i;n++)u+=a[p(o)];return u},r.shortenText=function(e,t){t=r.isUint(t)?t:40;var n=e.replace(/[\n\r]/g,"");return n.length>t?n.substr(0,t)+" ...":n},r.findIndexInObjectArray=function(e,t){var r,n;for(r=0,n=e.length;r<n;r++)if(e[r][t])return r;return null},r.findValueInObjectArray=function(e,t){var n=r.findIndexInObjectArray(e,t);return n?e[n][t]:null},r.getKeyByValue=function(e,t){if(r.isObject(e))return Object.keys(e).filter(function(r){return e[r]===t})[0]},r.createBrowserInfo=function(){var e,t,n="Unknown",i="";if(screen.width){var o=screen.width?screen.width:"",a=screen.height?screen.height:"";i+=""+o+" x "+a}var s,c,d,u=navigator.appVersion,p=navigator.userAgent,l=navigator.appName,m=""+parseFloat(u),f=parseInt(u,10);(c=p.indexOf("Opera"))!==-1&&(l="Opera",m=p.substring(c+6),(c=p.indexOf("Version"))!==-1&&(m=p.substring(c+8))),(c=p.indexOf("OPR/"))!==-1?(l="Opera",m=p.substring(c+4)):(c=p.indexOf("MSIE"))!==-1?(l="Microsoft Internet Explorer",m=p.substring(c+5)):"Netscape"===l&&(c=p.indexOf("Trident/"))!==-1?(l="Microsoft Internet Explorer",m=p.substring(c+8),(c=p.indexOf("rv:"))!==-1&&(m=p.substring(c+3))):"Netscape"===l&&(c=p.indexOf("Edge/"))!==-1?(l="Microsoft Edge",m=p.substring(c+5)):(c=p.indexOf("Chrome"))!==-1?(l="Chrome",m=p.substring(c+7)):(c=p.indexOf("Safari"))!==-1?(l="Safari",m=p.substring(c+7),(c=p.indexOf("Version"))!==-1&&(m=p.substring(c+8)),p.indexOf("CriOS")!==-1&&(l="Chrome")):(c=p.indexOf("Firefox"))!==-1?(l="Firefox",m=p.substring(c+8)):(s=p.lastIndexOf(" ")+1)<(c=p.lastIndexOf("/"))&&(l=p.substring(s,c),m=p.substring(c+1),l.toLowerCase()===l.toUpperCase()&&(l=navigator.appName)),(d=m.indexOf(";"))!==-1&&(m=m.substring(0,d)),(d=m.indexOf(" "))!==-1&&(m=m.substring(0,d)),(d=m.indexOf(")"))!==-1&&(m=m.substring(0,d)),f=parseInt(""+m,10),isNaN(f)&&(m=""+parseFloat(u),f=parseInt(u,10));var v=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(u),h=navigator.cookieEnabled;"undefined"!=typeof navigator.cookieEnabled||h||(document.cookie="testcookie",h=document.cookie.indexOf("testcookie")!==-1);var g=n,_=[{os:"Windows XP",regex:/(Windows NT 5.1|Windows XP)/},{os:"Windows Server 2003",regex:/Windows NT 5.2/},{os:"Windows Vista",regex:/Windows NT 6.0/},{os:"Windows 7",regex:/(Windows 7|Windows NT 6.1)/},{os:"Windows 8.1",regex:/(Windows 8.1|Windows NT 6.3)/},{os:"Windows 8",regex:/(Windows 8|Windows NT 6.2)/},{os:"Windows NT 4.0",regex:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{os:"Windows ME",regex:/Windows ME/},{os:"Android",regex:/Android/},{os:"Open BSD",regex:/OpenBSD/},{os:"Sun OS",regex:/SunOS/},{os:"Linux",regex:/(Linux|X11)/},{os:"iOS",regex:/(iPhone|iPad|iPod)/},{os:"Mac OS X",regex:/Mac OS X/},{os:"Mac OS",regex:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{os:"QNX",regex:/QNX/},{os:"UNIX",regex:/UNIX/},{os:"BeOS",regex:/BeOS/},{os:"OS/2",regex:/OS\/2/},{os:"Search Bot",regex:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(e=0,t=_.length;e<t;++e)if(_[e].regex.test(p)){g=_[e].os;break}var S=n;switch(/Windows/.test(g)&&(S=(/Windows (.*)/.exec(g)||[])[1],g="Windows"),g){case"Mac OS X":S=(/Mac OS X (10[\.\_\d]+)/.exec(p)||[])[1];break;case"Android":S=(/Android ([\.\_\d]+)/.exec(p)||[])[1];break;case"iOS":S=/OS (\d+)_(\d+)_?(\d+)?/.exec(u)||[],S=S[1]+"."+S[2]+"."+(0|S[3])}r.browserInfo={screenSize:i,browser:l,browserVersion:m,mobile:v,os:g,osVersion:S,cookiesEnabled:h}},r.createBrowserInfo(),r}.apply(t,n),/**
	 * @license NanoTools 2.1.0
	 * Copyright (c) 2016-2018 nanocosmos IT GmbH. All rights reserved.
	 * http://www.nanocosmos.de
	 * debug/log
	 */
!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(4)],i=function(){"use strict";var e=function(e){this.stream=e.stream,this.kind=e.kind,this.metadata={hasVideo:!1,hasAudio:!1,width:0,height:0,framerate:0},this.gotMetadata=!1,this.remoteUserName=e.remoteUserName,this.remoteUserId=e.remoteUserId,this.getTracks=function(){return[].concat(this.getVideoTracks()).concat(this.getAudioTracks())},this.getVideoTracks=function(){return this.stream.getVideoTracks()},this.getAudioTracks=function(){return this.stream.getAudioTracks()},this.hasVideoTracks=function(){return this.stream.getVideoTracks().length},this.hasAudioTracks=function(){return this.stream.getAudioTracks().length},this.muteTracks=function(e,t){var r="videoinput"===e?this.getVideoTracks():"audioinput"===e?this.getAudioTracks():void 0;if(r)for(var n=0;n<r.length;n++)r[n].enabled=!t},this.bind=function(e){for(var t=this.getTracks(),r=0;r<t.length;r++)t[r].onended=e._onTrackEnded.bind(e)},this.unbind=function(){var e={};if(e.data={},null!==this.stream){for(var t=this.getTracks(),r=0;r<t.length;r++)t[r].onended=void 0;this._stopTracks(t),this.stream=null}this.metadata={hasAudio:!1,hasVideo:!1,width:0,height:0,framerate:0},this.gotMetadata=!1},this._stopTracks=function(e){for(var t=0;t<e.length;t++)e[t].stop()}};return e}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(3),r(4),r(7),r(8)],i=function(e,t,r,n){"use strict";var i=t.error_,o=t.debug_,a=t.isBool,s=t.isFunction,c={_devices:{videoinput:[],audioinput:[],all:function(){return[].concat(c._devices.videoinput).concat(c._devices.audioinput)},isEmpty:function(){return!(this.all().length>0)},hasSCD:function(){var t=c._devices.videoinput.length-1,r=c._devices.videoinput[t];return r&&r.deviceId===e.MEDIA_SOURCES.SCREEN}},_listed:function(){var e=c._devices.all();return c._getListedFromDevices(e)},_selected:{videoinput:!0,audioinput:!0},_tempDevice:void 0,_reenumeratedOnce:!1};return c.enumerateDevices=function(){return c._verifyEnumerateDevicesExistence().then(function(e){return e.enumerateDevices()}).then(function(e){var t=c._createDevices(e),r=!1;r=c._updateDevices(t);var n=c._tempDevice;if(n&&!c._devices.hasSCD()){var i=c._devices.videoinput.length;n.displayIndex=i,c._devices[n.kind].push(n)}return Promise.resolve({data:{devices:{videodevices:c._listed().videoinput,audiodevices:c._listed().audioinput},updated:r}})}).catch(function(e){if(!e){var t=n.ObjectNotExistError("error","Error"),r="DeviceController: enumerateDevices: "+JSON.stringify(t);return i(r),Promise.reject(t)}if("NanoError"===e.type){var o=n.composeEvent(e),r="DeviceController: enumerateDevices: "+JSON.stringify(e);return i(r),Promise.reject(o)}var t=n.EnumerateDevicesError(e),o=n.composeEvent(t),r="DeviceController: enumerateDevices: "+JSON.stringify(t);return i(r),Promise.reject(o)})},c.addScreenCaptureDevice=function(e){var n=t.browserInfo.browser;if("Firefox"!==n&&"Chrome"!==n)return{};var i="videoinput",o={deviceId:"screen",kind:i,label:e+" ("+n+")",displayLabel:e+" ("+n+")"},a=new r(o);if("Chrome"!==n||c._devices.isEmpty())return c._tempDevice=a,{};var s=c._devices.videoinput.length;return a.displayIndex=s,c._devices[i].push(a),{data:{devices:{videodevices:c._listed().videoinput,audiodevices:c._listed().audioinput},updated:!0}}},c.setDevice=function(e,t){if("videoinput"===e||"audioinput"===e){var r=t.device,n=c._devices[e],i=c._selected[e];if(a(r)||(r=n[r]),r)if(r.deviceId){i=!1;for(var o=0;o<n.length;o++)if(r.deviceId===n[o].deviceId){"videoinput"===e&&r.setVideoDeviceConfig(t),i=r;break}}else i=!0;else i=!1;return c._selected[e]=i,i}},c.getDevice=function(e){if("videoinput"===e||"audioinput"===e){var t=c._selected;return t[e]}},c.updateSelected=function(e,t){var r=e.getVideoTracks(),n=c.getDevice("videoinput");if(r&&r.length>0)if(t||"screen"!==!n.deviceId){var n=c.getDevice("videoinput");if(!a(n)){var i=n.videoDeviceConfig||{};n.setVideoDeviceConfig(i)}c._selected.videoinput=n}else{var o=r[0].label,s=c._getDeviceForLabel(o),n=c.getDevice("videoinput");if(n===!0||s.label!==n.label){var i=n.videoDeviceConfig||{};s.setVideoDeviceConfig(i),c._selected.videoinput=s}}var d=e.getAudioTracks();if(d&&d.length>0)if(t){var u=c.getDevice("audioinput");c._selected.audioinput=u}else{var p=d[0].label,l=c._getDeviceForLabel(p),u=c.getDevice("audioinput");u!==!0&&l.label===u.label||(c._selected.audioinput=l)}},c.shouldReenumerate=function(e){if(e&&c._reenumeratedOnce)return!1;c._reenumeratedOnce=!0;for(var t=0,r=c._devices.all(),n=0;n<r.length;n++){var i=r[n],o=i.label||"";""===o&&(t+=1)}var a=c._devices.hasSCD()?r.length-1:r.length,s=t==a;return s},c.composeConstraints=function(e){return c._getConstraintTypes(e).then(function(t){for(var r={audio:!1,video:!1},n=0;n<t.length;n++)switch(t[n]){case"video":a(e.videoinput)?r.video=e.videoinput:(r.video=e.videoinput.videoDeviceConfig,r.video.deviceId={exact:e.videoinput.deviceId});break;case"audio":a(e.audioinput)?r.audio=e.audioinput:(r.audio={},r.audio.deviceId={exact:e.audioinput.deviceId});break;case"screen":var i=e.videoinput.videoDeviceConfig;r.video={width:i.width.ideal,height:i.height.ideal,frameRate:i.frameRate.ideal},a(e.audioinput)?r.audio=e.audioinput:(r.audio={},r.audio.deviceId={exact:e.audioinput.deviceId})}return o("constraints: "+JSON.stringify(r)),Promise.resolve(r)}).catch(function(e){var t="DeviceController: composeConstraints: "+JSON.stringify(e);return i(t),Promise.reject(e)})},c._createDevices=function(e){for(var t={videoinput:[],audioinput:[]},n=0;n<e.length;n++){var i=e[n],o=i.kind;if("videoinput"===o||"audioinput"===o){var a=t[o].length;i.displayIndex=a;var s=new r(i);t[o].push(s)}}return t},c._addDevices=function(e){for(;this._devices.videoinput.length;)this._devices.videoinput.pop();for(;this._devices.audioinput.length;)this._devices.audioinput.pop();this._devices.videoinput=e.videoinput,this._devices.audioinput=e.audioinput},c._updateDevices=function(e){var t=[].concat(e.videoinput).concat(e.audioinput),r=c._devices.all().filter(function(e){return"screen"!==e.deviceId}),n=!1;if(r.length!==t.length)n=!0;else for(var i=(r.length,0);i<r.length;i++){var o=r[i],a=t[i],s=["constraints","setVideoDeviceConfig","videoDeviceConfig"];for(var d in o)if(o.hasOwnProperty(d)&&a.hasOwnProperty(d)&&s.indexOf(d)===-1&&s.indexOf(d)===-1&&o[d]!==a[d]){n=!0;break}}return c._addDevices(e),n},c._getDeviceForLabel=function(e){var t=c._devices.all();if(e.indexOf("screen")!==-1)for(var r=0;r<t.length;r++){var n=t[r];if("screen"===n.deviceId)return n}else for(var r=0;r<t.length;r++){var n=t[r];if(n.label===e)return n}},c._getListedFromDevices=function(e){for(var t={videoinput:[],audioinput:[]},r=0;r<e.length;r++){var n=e[r],i=n.kind;t[i].push({index:n.displayIndex,id:n.label||n.displayId})}return t},c._getConstraintTypes=function(t){if(!t){var r=n.ObjectNotExistError("devices","Array"),o="DeviceController: _getConstraintTypes: "+JSON.stringify(r);return i(o),Promise.reject(r)}var s=[];if(t.videoinput){var c=t.videoinput.videoDeviceConfig?t.videoinput.videoDeviceConfig.source:a(t.videoinput)?e.MEDIA_SOURCES.CAMERA:void 0;if(!e.MEDIA_SOURCES.containsValue(c)){var r=n.EnumValueNotValidError(c,e.MEDIA_SOURCES),o="DeviceController: _getConstraintTypes: "+JSON.stringify(r);return i(o),Promise.reject(r)}s.push(c===e.MEDIA_SOURCES.SCREEN?"screen":"video")}return t.audioinput&&(t.videoinput&&"screen"!==t.videoinput.deviceId||!t.videoinput)&&s.push("audio"),Promise.resolve(s)},c._verifyEnumerateDevicesExistence=function(){var e=navigator.mediaDevices;if(!e||!s(e.enumerateDevices)){var t=n.FunctionNotDefinedError("enumerateDevices"),r="DeviceController: _verifyEnumerateDevicesExistence: "+JSON.stringify(t);return i(r),Promise.reject(t)}return Promise.resolve(e)},c}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(3)],i=function(e){"use strict";var t=function(t){this.deviceId=t.deviceId,this.kind=t.kind,this.label=t.label,this.groupId=t.groupId,this.displayIndex=t.displayIndex,this.displayId=t.kind+"device ID: "+t.deviceId.substr(0,10),this.videoDeviceConfig={},this.constraints={},this.setVideoDeviceConfig=function(t){t=t||{};var r=t.source||e.MEDIA_SOURCES.CAMERA,n=t.width||0,i=t.height||0,o=t.framerate||0,a=t.minFramerate||0;r!==e.MEDIA_SOURCES.CAMERA&&r!==e.MEDIA_SOURCES.SCREEN||(this.videoDeviceConfig.source=r),o<a&&(o=a),n>0&&i>0&&(this.videoDeviceConfig.width={ideal:n},this.videoDeviceConfig.height={ideal:i}),o>0&&(this.videoDeviceConfig.frameRate={ideal:o})}};return t}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[],i=function(){"use strict";var e=function(e,t,r,n){this.name=e,this.type="NanoError",this.code=t,this.message=r,this.userinfo=n,this.toJSON=function(){var e={error:{name:this.name,type:this.type,code:this.errorCode,message:this.message,userinfo:this.userinfo}};return e}},t=function(){};return t.GeneralError=function(t){var r="GeneralError",n=1e3,t=t;return new e(r,n,t)},t.TypeNotValidError=function(t,r){var n="TypeNotValidError",i=1001,o='"'+t+'" type not valid';return new e(n,i,o,{value:t,expected_type:r})},t.ValueNotValidError=function(t,r){var n="ValueNotValidError",i=1002,o='"'+t+'" value not valid';return new e(n,i,o,{value:t,expected_value:r})},t.EnumValueNotValidError=function(t,r){var n="EnumValueNotValidError",i=1003,o='"'+t+'" enum value not valid';return new e(n,i,o,{value:t,expected_values:r.toString()})},t.ObjectNotExistError=function(t,r){var n="ObjectNotExistError",i=1004,o='"'+t+'" object not exist';return new e(n,i,o,{value:t,expected_type:r})},t.FunctionNotDefinedError=function(t){var r="FunctionNotDefinedError",n=1005,i='"'+t+'" function not defined';return new e(r,n,i,{func:t})},t.RequestError=function(t,r){var n="RequestError",i=2e3,o="";return new e(n,i,o,{status:t,statusText:r})},t.WebSocketError=function(t,r){var n="WebSocketError",i=3e3;return new e(n,i,t,{server:r})},t.WrongStateError=function(t){var r="WrongStateError",n=3001,i="Wrong state";return new e(r,n,i,{state:t})},t.SignInError=function(t){var r="SignInError",n=4e3,i="Sign in failed";return new e(r,n,i,{reason:t})},t.NotSignedInError=function(){var t="NotSignedInError",r=4001,n="Session not signed in";return new e(t,r,n)},t.StartBroadcastError=function(t){var r="StartBroadcastError",n=5001,i="Starting broadcast failed";return new e(r,n,i,{reason:t})},t.BroadcastError=function(t){var r="BroadcastError",n=5002,i="Broadcast failed";return new e(r,n,i,{reason:t})},t.StopBroadcastError=function(t){var r="StopBroadcastError",n=5003,i="Stopping broadcast failed";return new e(r,n,i,{reason:t})},t.DeviceBlockedError=function(t,r){var n="DeviceBlockedError",i=6e3,o="Media stream received, but no "+(t?t+" ":"")+"data from device"+(r?' "'+r+'". ':". ")+"Device could be in use from another application";return new e(n,i,o,{kind:t,label:r})},t.MediaStreamTrackError=function(){var t="MediaStreamTrackError",r=6001,n="Media stream received, but no tracks";return new e(t,r,n,{})},t.MediaStreamNotFoundError=function(){var t="MediaStreamNotFoundError",r=6002,n="Media stream not found";return new e(t,r,n,{})},t.MediaStreamNotRemovedError=function(){var t="MediaStreamNotRemovedError",r=6003,n="Media stream not removed";return new e(t,r,n,{})},t.DevicesNotFoundError=function(){var t="DevicesNotFoundError",r=6004,n='Devices not set for "getUserMedia"';return new e(t,r,n,{})},t.GetUserMediaError=function(t,r){var n=t&&t.constraint?t.constraint:void 0,i=t&&t.name&&!n?t.name:n?"OverconstrainedError":"GetUserMediaError",o=6005,a=t&&t.message?t.message:"Failed to get user / display media.";return new e(i,o,a,{constraint:n,retry:r})},t.EnumerateDevicesError=function(t){var r=t&&t.name?t.name:"EnumerateDevicesError",n=6006,i=t&&t.message?t.message:"Failed to enumerate devices.";return new e(r,n,i,{})},t.ReceiveMetadataError=function(t){var r=t&&t.name?t.name:"ReceiveMetadataError",n=6007,i="Metadata already received";return new e(r,n,i,{})},t.ServerError=function(t){var r="ServerError",n=7e3,i="An error has occurred on server side";return new e(r,n,i,{reason:t})},t.composeEvent=function(e,t){var r="",n=void 0,i="",o=void 0;switch(e.name){case"GeneralError":r="GeneralError",i=e.message||"General error";break;case"TypeNotValidError":r="TypeNotValidError",i=e.message;break;case"ValueNotValidError":r="ValueNotValidError",i=e.message;break;case"EnumValueNotValidError":r="EnumValueNotValidError",i=e.message;break;case"ObjectNotExistError":r="ObjectNotExistError",i=e.message;break;case"FunctionNotDefinedError":e.userinfo&&e.userinfo.func&&(e.userinfo.func.indexOf("getUserMedia")!==-1?r="GetUserMediaError":e.userinfo.func.indexOf("getDisplayMedia")!==-1?r="GetDisplayMediaError":e.userinfo.func.indexOf("enumerateDevices")!==-1&&(r="EnumerateDevicesError"),i=e.userinfo.func+" not defined");break;case"RequestError":r="RequestError",i=e.message;break;case"WebSocketError":r="RequestError";break;case"WrongStateError":r="WrongStateError",i=e.message;break;case"SignInError":r="SignInError",i=e.message;break;case"NotSignedInError":r="NotSignedInError",i=e.message;break;case"StartBroadcastError":r="StartBroadcastError",i=e.message;break;case"BroadcastError":r="BroadcastError",i=e.message;break;case"StopBroadcastError":r="StopBroadcastError",i=e.message;break;case"DeviceBlockedError":r="MediaStreamError",i=e.message;break;case"MediaStreamTrackError":r="MediaStreamError",i=e.message;break;case"MediaStreamNotFoundError":r="NoStreamError",i="No stream is available for the device.";break;case"MediaStreamNotRemovedError":r="MediaStreamNotRemovedError",i=e.message;break;case"DevicesNotFoundError":r="NoDeviceError",i='No device is available for "getUserMedia".';break;case"GetUserMediaError":case"PermissionDenied":case"NotAllowedError":case"NotReadableError":case"NotFoundError":case"OverconstrainedError":case"AbortError":case"GetMediaError":case"NoDeviceError":case"NoStreamError":r=e.name,i=e.message,n=e.userinfo.constraint,o=e.userinfo.retry;break;case"EnumerateDevicesError":r="EnumerateDevicesError",i=e.message;break;case"ServerError":r="ServerError",i=e.message;break;default:r=e.name||"UnknownError",i=e.message||"Unknown error."}var a={};return a.name=t||e.name,a.data={error:r+": "+i,message:i,text:i,constraint:n,errorType:r,retry:o},a.error={name:e.name,type:e.type,code:e.code,message:e.message,text:e.message,userinfo:e.userinfo},a},t}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n;(function(){"use strict";function t(){}function i(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function o(e){return function(){return this[e].apply(this,arguments)}}var a=t.prototype,s=this,c=s.EventEmitter;a.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp){t={};for(r in n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r])}else t=n[e]||(n[e]=[]);return t},a.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},a.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&(t={},t[e]=r),t||r},a.addListener=function(e,t){var r,n=this.getListenersAsObject(e),o="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&i(n[r],t)===-1&&n[r].push(o?t:{listener:t,once:!1});return this},a.on=o("addListener"),a.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},a.once=o("addOnceListener"),a.defineEvent=function(e){return this.getListeners(e),this},a.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},a.removeListener=function(e,t){var r,n,o=this.getListenersAsObject(e);for(n in o)o.hasOwnProperty(n)&&(r=i(o[n],t),r!==-1&&o[n].splice(r,1));return this},a.off=o("removeListener"),a.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},a.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},a.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):a.call(this,n,i));return this},a.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},a.removeAllListeners=o("removeEvent"),a.emitEvent=function(e,t){var r,n,i,o,a,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(r=s[o].slice(0),i=r.length;i--;)n=r[i],n.once===!0&&this.removeListener(e,n.listener),a=n.listener.apply(this,t||[]),a===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},a.trigger=o("emitEvent"),a.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},a.emitSimple=function(e,t,r){return this.emitEvent(e,[{name:e||"AnonymousEvent",target:r||this,data:t||{}}])},a.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},a._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},a._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return s.EventEmitter=c,t},n=function(){return t}.call(s,r,s,e),!(void 0!==n&&(e.exports=n))}).call(this)},function(e,t,r){var n,i;n=[r(11),r(14),r(3),r(9),r(4),r(18),r(8)],i=function(e,t,r,n,i,o,a){"use strict";function s(e,t,r){n.call(this),m(e)||p("Broadcaster: param userName must be a string",2),m(r)||p("Broadcaster: param room must be a string",2),f(t)||p("Broadcaster: param userId must be an integer",2),this._userName=e,this._userId=t,this._remoteUserId=t,this._peerId=void 0,this._remotePeerId=void 0,this._room=r,this._remoteUserName="webrtc2H264",this._pcClient=void 0,this._streams=[],this._transcodingSettings={output:null,streamname:null,videobitrate:null,videowidth:null,videoheight:null,audiobitrate:null,framerate:null,dropframes:null,h264passthrough:1,icecast_audio:null,rtmpconnectinfo:null},this._startTime=null,this._iceServers=[],this._config={},this._state=_.IDLE,this._messageQueue=[],this._remoteStream=null,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._statsInterval=0,this._rtcStats=null}var c="[Broadcaster] - ",d=function(e){i.debug_(c+v(e))},u=function(e){i.warning_(c+v(e))},p=function(e){i.error_(c+v(e))},l=function(e){i.success_(c+v(e))},m=i.isString,f=i.isIntString,v=i.stringifyJSON,h=i.isObject,g=i.isArray,_=r.BROADCAST_STATE,S=s.prototype=Object.create(n.prototype);return S.setIceServers=function(e){this._iceServers=e},S.setConfig=function(e){this._config=e},S.getState=function(){return this._state},S.getPeerId=function(){return this._peerId},S.setTranscodingSettings=function(e){var t;for(t in e)this._transcodingSettings.hasOwnProperty(t)&&(this._transcodingSettings[t]=e[t])},S.start=function(){d("start()");var t,r=this;return e.startBroadcast(this._getBroadcastParameters()).then(function(n){return r._peerId=n.peer_id,r._setState(_.INITIALIZED),t="receiver_peer_"+r._peerId,e.registerListener(t,r._onServerMessage.bind(r)),r._transcodingSettings.streamname}).catch(function(e){return r._setState(_.FAILED),Promise.reject(e)})},S.stop=function(){d("stop()");var t=this;return t._stopCollectRtcStats(),t._peerId&&t._remotePeerId?e.isSignedIn()?e.stopBroadcast({sender_peer:this._peerId,receiver_peer:this._remotePeerId}).then(function(){t.destroy(),l("broadcast stopped")}).catch(function(e){return e&&"NanoError"===e.type&&p(a.StopBroadcastError("Stopping broadcast failed: "+e)),t.destroy(),l("broadcast stopped"),Promise.reject(e)}):(t.destroy(),Promise.resolve()):Promise.reject(a.StopBroadcastError("Not connected to any peer"))},S.addStream=function(e){return d("addStream()"),e?2===this._streams.length?void u("[peer id: r "+this._peerId+"] stream count is already=2, we only support 2 streams/Broadcaster"):void(g(e)?this._streams=e:this._streams.push(e)):void p("[peer id: "+this._peerId+'] parameter "stream" must not be undefined')},S.sendMetaData=function(t,r){if(d("sendMetaData()"),this.getState()===_.BROADCASTING){d("[peer id: "+this._peerId+"] sending metaData: "+t+" - "+v(r));var n={eventType:"metaData",eventName:t,strLabel:this._streams[0].id,payload:r},i={sender_peer:this._peerId,receiver_peer:this._remotePeerId,data:n};return e.sendMetaData(i)}var o="[peer id: "+this._peerId+"]Tried to send metaData but Broadcaster is not in active state";return p(o),Promise.reject(o)},S.enableStats=function(e,t){d("enableStats()"),this._statsEnabled="undefined"==typeof e||e,this._statsIntervalTime=t||1e3,this._rtcStats=null,this._statsEnabled&&(this._rtcStats=new o,this._rtcStats.on("ReceivedWebRTCStats",this._reemit.bind(this)))},S.destroy=function(){d("destroy()"),this._unbind(),this._closePCClient(),this._setState(_.STOPPED)},S._getBroadcastParameters=function(){var e={};e.peer=this._peerId,e.room=this._room;var t;for(t in this._transcodingSettings){var r=this._transcodingSettings[t];null!==r&&((h(r)||m(r))&&(r=v(r)),e[t.toString()]=r.toString())}return e.stream_label=this._streams[0]&&this._streams[0].id?this._streams[0].id:"",e.stream_label2=this._streams[1]&&this._streams[1].id?this._streams[1].id:"",e.videocodec=this._config.codecs.videoCodec?this._config.codecs.videoCodec:"H264",e.audio=this._streams[0].getAudioTracks().length>0?"1":"0",e.video=this._streams[0].getVideoTracks().length>0?"1":"0",e},S._onServerMessage=function(t){var r=this;switch(t.type){case"transcoder_message":"started"===t.state?r._pcClient?p("we should not have a pcClient at this moment"):(r._createPCClient(),r._pcClient.startAsCallee(r._messageQueue),r._setState(_.STARTED)):"disconnected"===t.state&&(r._setState(_.DISCONNECTED),d("disconnected"));break;case"sdp_message":if(!t.sender_peer)return void p("Received sdp_message, but message has no sender_peer");r._remotePeerId=t.sender_peer,r._pcClient&&r._pcClient.isStarted()?r._pcClient.setRemoteDescription(t.data.sdp).catch(function(e){return p("setRemoteDescription failed:",e),Promise.reject(e)}).then(function(){return l("setRemoteDescription succeded"),r._pcClient.doAnswer()}).catch(function(e){return p("doAnswer failed:",e),Promise.reject(e)}).then(function(t){l("doAnswer succeded "+t);var n={};return n.sender_peer=r._peerId,n.receiver_peer=r._remotePeerId,n.data=t,e.sendSignalingMessage(n).catch(function(e){p("sendSignalingMessage - "+e)})}).catch(function(e){p("doAnswer failed:",e)}):r._messageQueue.push(t.data.sdp);break;case"ice_candidate":r._pcClient&&r._pcClient.isStarted()?r._pcClient.addIceCandidate(t.data.candidate):r._messageQueue.push(t.data.candidate);break;case"rtmp_status":d("received rtmp status: "+v(t.data)),t.data&&"status"===t.data.status&&("connected"===t.data.message?r._setState(_.BROADCASTING):"reconnecting"===t.data.message&&r._setState(_.RECONNECTING)),t.data&&"error"===t.data.status&&4711===t.data.number&&r._setState(_.FAILED);var n=this._addEventPayload({data:t.data});r.emit("BroadcastStatus",n);break;case"server_error":r._setState(_.FAILED),console.error("server error: ",t.error);break;default:console.log("unknown message:",t)}},S._addEventPayload=function(e){return e=e||{},e.data=e.data||{},e.data.streamname=this._transcodingSettings.streamname,e.data.state=this._state,e.data.message=i.getKeyByValue(_,this._state).toLowerCase(),e.data.text=e.data.message,e},S._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},S._collectRtcStats=function(){var e=this;clearInterval(e._statsInterval),this._statsInterval=setInterval(function(){if(!e._pcClient)return void clearInterval(e._statsInterval);var t=void 0,r=e._getBroadcastParameters();if("1"===r.video&&"0"===r.audio)t="video";else if("0"===r.video&&"1"===r.audio)t="audio";else if("0"===r.video&&"0"===r.audio)return void p('Attempts to show stats for "no vide" and "no audio" stream');e._pcClient.getStats(t).then(function(r){e._rtcStats||(e._rtcStats=new o),e._rtcStats.putReport(r,t)}).catch(function(t){p("[peer id: "+e._peerId+"] "+t)})},this._statsIntervalTime)},S._stopCollectRtcStats=function(){this._statsInterval&&(d("stopping rtc stats collection"),clearInterval(this._statsInterval),this._rtcStats=null)},S._getPeerConnectionConfig=function(){d("_getPeerConnectionConfig()");var e={iceServers:this._iceServers,iceTransports:"all"},t={optional:[],mandatory:[]};t.optional.push({googCpuOveruseDetection:!1}),t.optional.push({RtpDataChannels:!1});var r={mediaConstraints:{audio:!0,video:!0},sdpPatches:this._config.sdpPatches,peerConnectionConfig:e,peerConnectionConstraints:t,send:0!==this._streams.length,receive:!1,videoSendCodec:this._config.codecs.videoCodec||"H264",videoRecvCodec:this._config.codecs.videoCodec||"H264",videoSendBitrate:this._config.bitrates.videoSendBitrate||0,videoSendInitialBitrate:this._config.bitrates.videoSendInitialBitrate||0};return r},S._createPCClient=function(){function e(e,t){d("Callstats Monitoring status: "+e+" msg: "+t)}if(d("_createPCClient()"),this._pcClient)return void d("[peer id:  "+this._peerId+"] PeerConnection still alive, do not create!");try{if(this._pcClient=new t(this._getPeerConnectionConfig(),this._startTime),"object"==typeof callstats&&callstats&&callstats.fabricUsage)try{var r=callstats.fabricUsage.multiplex,n=this._remoteUserName,i=this._userName+"-"+this._remoteUserName+"_"+this._peerId+"_"+this._userId+"__"+this._remotePeerId+"_"+this._remoteUserId+"_"+this._room;callstats.addNewFabric(this._pcClient._pc,n,r,i,e)}catch(e){u("Error in callstats")}this._bind();for(var o=0;o<this._streams.length;o++)this._pcClient.addStream(this._streams[o]);l("Created PeerConnectionClient")}catch(e){p("[peer id: "+this._peerId+"] Create PeerConnection exception: "+e.message),this.emitSimple("CreatePeerConnectionClientError")}},S._bind=function(){d("_bind()"),this._pcClient.on("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.on("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.on("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.on("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.on("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},S._unbind=function(){d("_unbind()"),this._pcClient.off("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.off("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.off("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.off("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.off("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.off("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},S._setState=function(e){if(e!==this._state){var t=this._state;this._state=e,d("STATE: "+i.getKeyByValue(_,t)+" -> "+i.getKeyByValue(_,this._state))}},S._onIceConnectionStateChange=function(e){switch(d("ice connection state: "+e.data.state),e.data.state){case"new":case"checking":this._setState(_.SIGNALING);break;case"connected":case"completed":this._setState(_.CONNECTED),this._statsEnabled&&this._pcClient&&this._collectRtcStats();break;case"failed":this._setState(_.FAILED),this._statsEnabled&&this._pcClient&&this._stopCollectRtcStats();break;case"disconnected":this._setState(_.DISCONNECTED);break;case"closed":}e=this._addEventPayload(e),this.emit("BroadcastStatus",e)},S._onNegotiationNeeded=function(e){u("NegotiationNeeded event has been fired")},S._onEndOfLocalCandidates=function(e){d("_onEndOfLocalCandidates()")},S._onRemoteStreamAdded=function(e){d("_onRemoteStreamAdded()"),this._remoteStream=e.data.stream},S._onRemoteStreamRemoved=function(e){d("_onRemoteStreamRemoved()"),this._remoteStream=null},S._closePCClient=function(){if(d("_closePCClient()"),this._pcClient){var e,t,r=this._streams;for(e=0,t=r.length;e<t;++e)try{this._pcClient.removeStream(r[e])}catch(e){p("[peer id: "+this._peerId+"] Could not remove stream from peerconnectionclient")}this._pcClient.close(),this._pcClient=null}},S._sendMessageToPeer=function(t){d("_sendMessageToPeer()");var r={},n=void 0;return this._remotePeerId&&m(this._remotePeerId)||(n=this._remotePeerId?a.TypeNotValidError("_remotePeerId","String"):a.ObjectNotExistError("_remotePeerId","String")),this._peerId&&m(this._peerId)||(n=this._peerId?a.TypeNotValidError("_peerId","String"):a.ObjectNotExistError("_peerId","String")),h(t)||(n=a.TypeNotValidError("message","Object")),n?(p(n),Promise.reject(n)):(r.sender_peer=this._peerId,r.receiver_peer=this._remotePeerId,r.data=t,e.sendSignalingMessage(r).catch(function(e){return p("_sendMessageToPeer - "+e),Promise.reject(e)}))},S._onSignalingMessage=function(e){return d("_onSignalingMessage - "+v(e.data)),this._remotePeerId?void this._sendMessageToPeer(e.data).then(function(){}).catch(function(e){p(e)}):void p("Trying to send message, but no remote peer set! This should not happen!")},s}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(9),r(12),r(13),r(4),r(8)],i=function(e,t,r,n,i){"use strict";var o="[Session] - ",a=n.stringifyJSON,s=function(e){n.debug_(o+a(e))},c=function(e){n.warning_(o+a(e))},d=function(e){n.error_(o+a(e))},u=function(e){n.success_(o+a(e))},p=n.isObject,l=n.isString,m={IDLE:1,SIGNED_IN:2,SIGNED_OUT:3,RECONNECTING:4,FAILED:5},f={_sessionId:void 0,_serverUrl:void 0,_eventEmitter:new e,_state:m.IDLE};return f.registerListener=function(e,t){f._eventEmitter.on(e,t)},f.removeEvent=function(e,t){f._eventEmitter.removeEvent(e)},f.removeAllListeners=function(){f._eventEmitter.removeAllListeners()},f.isSignedIn=function(){return f._state===m.SIGNED_IN},f.signIn=function(e){if(s("signOut()"),f.isSignedIn())return Promise.reject(i.SignInError("Already signed in"));if(!p(e))return Promise.reject(i.TypeNotValidError("data","Object"));if(!e.server||!l(e.server))return Promise.reject(i.TypeNotValidError("data.serverUrl","String"));if(!e.userName||!l(e.userName))return Promise.reject(i.TypeNotValidError("data.userName","String"));if(!e.room||!l(e.room))return Promise.reject(i.TypeNotValidError("data.room","String"));if(e.bintuApiKey&&!l(e.bintuApiKey))return Promise.reject(i.TypeNotValidError("data.bintuApiKey","String"));if(e.token&&!l(e.token))return Promise.reject(i.TypeNotValidError("data.token","String"));if(!f._checkRoomName(e.room))return Promise.reject(i.ValueNotValidError("data.room","Alphanumeric characters / underscore (_) / dash (-) / dot (.)"));f._serverUrl=e.server;var n={};return n.user_name=e.userName,n.room=e.room,e.bintuApiKey&&(n.bintu_api_key=e.bintuApiKey),e.token&&(n.token=e.token),n.api_version=r.webrtc.release_version,t.connect(f._serverUrl,f._onMessage).then(function(){return t.sendMessage("sign_in",n)}).then(function(e){return u("signed in, session id: "+e.session_id),f._sessionId=e.session_id,f._setState(m.SIGNED_IN),{data:{server:f._serverUrl,userId:e.user_id,iceServers:e.ice_servers?e.ice_servers:void 0}}}).catch(function(e){return d("signIn: "+e),t.close(),Promise.reject(e)})},f.signOut=function(){return s("signOut(), sessionId"+f._sessionId),f.isSignedIn()?t.sendMessage("sign_out",{session_id:f._sessionId}).then(function(e){return u("signOut() - "+e),f.removeAllListeners(),f._sessionId=void 0,f._setState(m.SIGNED_OUT),t.close(),e}).catch(function(e){return d(e),t.close(),f._sessionId=void 0,Promise.reject(e)}):Promise.reject(i.NotSignedInError())},f.echo=function(e){return t.sendMessage("echo",{session_id:f._sessionId,message:e})},f.sendSignalingMessage=function(e){return s("sendSignalingMessage()"),f.isSignedIn()?f._checkPeerMessage(e).then(t.sendMessage("signaling_message",e)).catch(function(e){return d(e),Promise.reject(e)}):Promise.reject(i.NotSignedInError())},f.enterRoom=function(e){return s("enterRoom(), sessionId: "+f._sessionId),f.isSignedIn()?p(e)?l(e.roomName)?l(e.userName)?f._checkRoomName(e.roomName)?t.sendMessage("enter_room",{session_id:f._sessionId,room_name:e.roomName,user_name:e.userName}):Promise.reject(i.ValueNotValidError("data.room","Alphanumeric characters / underscore (_) / dash (-) / dot (.)")):Promise.reject(i.TypeNotValidError("data.userName","String")):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError());
},f.leaveRoom=function(e){return s("leaveRoom(), sessionId: "+f._sessionId),f.isSignedIn()?p(e)?l(e.roomName)?t.sendMessage("leave_room",{session_id:f._sessionId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},f.callUser=function(e){return f.isSignedIn()?p(e)?l(e.userId)?l(e.roomName)?t.sendMessage("call_user",{session_id:f._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},f.answerCall=function(e){return f.isSignedIn()?p(e)?l(e.userId)?l(e.roomName)?t.sendMessage("answer_call",{session_id:f._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},f.declineCall=function(e){return f.isSignedIn()?p(e)?l(e.userId)?l(e.roomName)?t.sendMessage("decline_call",{session_id:f._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},f.hangUpCall=function(e){return f.isSignedIn()?t.sendMessage("hangup_call",{session_id:f._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.NotSignedInError())},f.startBroadcast=function(e){return s("startBroadcast()"),f.isSignedIn()?p(e)?(e.session_id=f._sessionId,t.sendMessage("start_broadcast",e).catch(function(e){return d(e),Promise.reject(e)})):Promise.reject(i.TypeNotValidError("broadcastParams","Object")):Promise.reject(i.NotSignedInError())},f.stopBroadcast=function(e){return s("stopBroadcast()"),f.isSignedIn()?p(e)?l(e.sender_peer)?l(e.receiver_peer)?f._checkPeerMessage(e).then(t.sendMessage("stop_broadcast",{session_id:f._sessionId,sender_peer:e.sender_peer,receiver_peer:e.receiver_peer})).catch(function(e){return d(e),Promise.reject(e)}):Promise.reject(i.TypeNotValidError("data.receiver_peer","String")):Promise.reject(i.TypeNotValidError("data.sender_peer","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},f.sendMetaData=function(e){return s("sendMetaData()"),f.isSignedIn()?f._checkPeerMessage(e).then(t.sendMessage("send_metadata",e)).catch(function(e){return d(e),Promise.reject(e)}):Promise.reject(i.NotSignedInError())},f.status=function(){return f.isSignedIn()?t.sendMessage("status",{}).catch(function(e){return d(e),Promise.reject(e)}):Promise.reject(i.NotSignedInError())},f._onMessage=function(e){s("_onMessage() - "+JSON.stringify(e));var t;if(e){if(e.receiver_peer)return t=e.receiver_peer,void f._eventEmitter.emit("receiver_peer_"+t,e);switch(e.type){case"room_update":case"call_incoming":case"call_declined":case"start_as_caller":case"hang_up":return f._eventEmitter.emit("RoomMessage",e);case"close":f._state!==m.SIGNED_OUT&&(f._eventEmitter.emit("SessionMessage",{type:"close",reason:"disconnect"}),f._setState(m.IDLE));break;default:c("unhandled message received: "+e)}}},f._setState=function(e){if(e!==f._state){var t=this._state;this._state=e,s("STATE: "+n.getKeyByValue(m,t)+" -> "+n.getKeyByValue(m,f._state))}},f._checkPeerMessage=function(e){return p(e)?e.sender_peer?e.receiver_peer?Promise.resolve():Promise.reject(i.TypeNotValidError("message.receiver_peer","String")):Promise.reject(i.TypeNotValidError("message.sender_peer","String")):Promise.reject(i.TypeNotValidError("message","Object"))},f._checkRoomName=function(e){return/^([a-zA-Z0-9_\-.]{1,})$/gm.test(e)},f}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(9),r(4),r(8)],i=function(e,t,r){"use strict";var n="[WebsocketClient] - ",i=t.isString,o=t.stringifyJSON,a=t.isObject,s=t.isInt,c=t.isFunction,d=function(e){t.debug_(n+o(e))},u=function(e){t.error_(n+o(e))},p=0,l={IDLE:1,CONNECTED:2,CLOSED:3},m={_websocket:void 0,_url:void 0,_callback:void 0,_state:l.IDLE,_resolvers:{}};return m.connect=function(e,t){return d("connect"),i(e)?c(t)?m._state!==l.IDLE&&m._state!==l.CLOSED?Promise.reject(r.WrongStateError()):(m._url=e,m._callback=t,m._websocket=new WebSocket(m._url),m._websocket.onclose=function(e){m._onClose(e)},m._websocket.onmessage=function(e){m._onMessage(e)},m._websocket.onerror=function(e){m._onError(e)},m._websocket.onopen=function(e){m._onOpen(e)},m._createResolver("connect")):Promise.reject(r.TypeNotValidError("callback","Function")):Promise.reject(r.TypeNotValidError("url","String"))},m.close=function(){d("close");var e;return m._websocket?(e=m._createResolver("close"),m._websocket.close(),m._setState(l.CLOSED)):e=Promise.reject(r.WebSocketError("No websocket",this._url)),e},m.sendMessage=function(e,t){if(d("sendMessage - "+e),!i(e))return Promise.reject(r.TypeNotValidError("type","String"));if(!a(t))return Promise.reject(r.TypeNotValidError("message","Object"));if(!m._websocket||m._websocket.readyState>1)return Promise.reject(r.WebSocketError("Sending message failed",m._url));var n=p++,s=m._createResolver(n);return m._websocket.send(o({type:e,message:t,message_id:n})),s},m._setState=function(e){if(e!==m._state){var r=this._state;this._state=e,d("STATE: "+t.getKeyByValue(l,r)+" -> "+t.getKeyByValue(l,this._state))}},m._onOpen=function(e){d("_onOpen() - "+e),m._setState(l.CONNECTED),m._resolve("connect",{event:e})},m._onClose=function(e){d("_onClose() - "+e),m._setState(l.CLOSED),m._resolve("close",{type:e.type,code:e.code})},m._onMessage=function(e){d("_onMessage() - "+e.data);var t,r;if(e&&e.data){try{t=JSON.parse(e.data)}catch(e){return void u("_onMessage() - "+e)}r=t.message_id,m._resolve(r,t)}else u('_onMessage() - event has no "data" property')},m._onError=function(e){u("_onError() - "+e),m._resolve("connect",{event:e})},m._createResolver=function(e){if(d("_createResolver() - "+e),!s(e)&&!i(e))return Promise.reject("resolver error"+e);var t,r,n=new Promise(function(e,n){t=e,r=n});return m._resolvers[e]={resolve:t,reject:r},n},m._resolve=function(e,t){d("_resolve() - "+e+" : "+t);var n=m._resolvers[e];if(n){if(d("_resolve - message id: "+e),delete m._resolvers[e],t&&t.event&&"error"===t.event.type&&"connect"===e)return n.reject(r.WebSocketError("Could not connect to server, please check server url",m._url));t.error?(d("rejecting: "+e),n.reject(t.error)):(d("resolving: ",e),n.resolve(t))}else d("passive message"),m._callback(t)},m}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[],i=function(){"use strict";var e={webrtc:{release_version:"5.1.2",release_description:"main"}};return JSON.parse(JSON.stringify(e))}.apply(t,n),/**
	 * @license WebRTC Release Version 5
	 * Copyright (c) 2016 nanocosmos IT GmbH. All rights reserved.
	 * http://www.nanocosmos.de
	 */
!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(15),r(9),r(8),r(4),r(17)],i=function(e,t,r,n,i){"use strict";function o(e,r){t.call(this),s("Creating RTCPeerConnnection with:\n  config: '"+l(e.peerConnectionConfig)+"';\n  constraints: '"+l(e.peerConnectionConstraints)+"'."),f(e.peerConnectionConfig.iceServers)&&0!==e.peerConnectionConfig.iceServers.length||c("params.peerConnectionConfig.iceServers parameter is malformed, must be an array with at least one entry"),this._params=e,this._startTime=r,this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1,this._create()}var a="[PeerConnectionClient] - ",s=function(e){n.debug_(a+l(e))},c=function(e){n.warning_(a+l(e))},d=function(e){n.error_(a+l(e))},u=function(e){n.success_(a+l(e))},p=n.parseJSON,l=n.stringifyJSON,m=n.isFunction,f=n.isArray,v={offerToReceiveAudio:!0,offerToReceiveVideo:!0},h=o.prototype=Object.create(t.prototype);return h.isStarted=function(){return this._started},h.isInitiator=function(){return this._isInitiator},h._create=function(){this.close();try{this._pc=new RTCPeerConnection(this._params.peerConnectionConfig,this._params.peerConnectionConstraints),this._bind(),s("PeerConnectionCreated")}catch(e){this._onError("CreatePeerConnection",e)}},h.close=function(){return this._pc?(this._pc.close(),this._reset(),void u("Peer connection closed")):void s("close() - no PeerConnection")},h.addStream=function(e){this._pc&&this._pc.addStream(e)},h.removeStream=function(e){var t,r,n;if(this._pc)if(m(this._pc.removeTrack)&&m(this._pc.getSenders)){var i=e.getTracks(),o=this._pc.getSenders();for(t=0,n=o.length;t<n;++t)for(r=0,n=i.length;r<n;++r)o[t].track===i[r]&&this._pc.removeTrack(o[t])}else m(this._pc.removeStream)&&this._pc.removeStream(e)},h.startAsCaller=function(e){if(this._pc&&!this._started){this._isInitiator=!0,this._started=!0;var t=this._buildConstraints(e);s("Sending offer to peer with constraints: \n'"+l(t)+"'.");var r=this;this._pc.createOffer(t).then(function(e){return r._setLocalDescription(e)}).then(function(e){r.emitSimple("SignalingMessage",e)}).catch(function(e){d(e),r._onError("createOffer",e)})}},h.startAsCallee=function(e){var t,r;if(this._pc&&!this._started){if(this._isInitiator=!1,this._started=!0,e&&e.length>0)for(t=0,r=e.length;t<r;t++)this.queueSignalingMessage(e[t]);this._messageQueue.length>0&&this._drainMessageQueue()}},h.queueSignalingMessage=function(e){var t=p(e);t&&(this._isInitiator&&"answer"===t.type||!this._isInitiator&&"offer"===t.type?(this._hasRemoteSdp=!0,this._messageQueue.unshift(t)):t.candidate?this._messageQueue.push(t):d("unknown message: "+l(e)))},h.setRemoteDescription=function(e){var t=this,r=t._adjustRemoteDescription(e);return t._pc.setRemoteDescription(new RTCSessionDescription(r)).then(function(){t._hasRemoteSdp=!0}).then(function(){for(var e=0,r=t._messageQueue.length;e<r;e++)t.addIceCandidate(t._messageQueue[e]);t._messageQueue=[]}).catch(function(e){return t._onError(t,"setRemoteDescription"),d(e),Promise.reject(e)})},h.doAnswer=function(){var e=this,t=this._buildConstraints();return s("Sending answer to peer with constraints: "+l(t,null," ")),this._pc.createAnswer(t).then(function(t){return e._setLocalDescription(t)}).catch(function(t){return e._onError("doAnswer",t),Promise.reject(t)})},h.addIceCandidate=function(e){var t,r;return this._hasRemoteSdp?(t=p(e),r=new RTCIceCandidate({sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}),console.log("adding ice candidate:",l(r.toJSON())),this._recordIceCandidate("Remote",r),this._pc.addIceCandidate(r).then(function(){u("MSG: Remote candidate added successfully.")}).catch(function(e){d("addIceCandidate: "+e)})):(this._messageQueue.push(e),s("addIceCandidate - queueing candidate, not reveiced remote sdp, yet"),Promise.resolve())},h.getStats=function(e){var t,n,i,o;if(!this._pc)return Promise.reject(new Error("No PeerConnection"));if(e&&"video"!==e&&"audio"!==e)return Promise.reject(r.ValueNotValidError("kind","video / audio"));if(m(this._pc.getSenders)){var a=this._pc.getSenders().filter(function(t){return i=t.track,!!i&&(i.kind&&i.kind===e)});a&&a.length&&(t=a[0].track)}else o=this._pc.getRemoteStreams(),o&&o.length&&(n="video"===e?o[0].getVideoTracks():"audio"===e?o[0].getAudioTracks():void 0,n.length&&(t=n[0]));return this._pc.getStats(t)},h._reset=function(){this._unbind(),this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1},h._bind=function(){return s("_bind()"),this._pc?(this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.ontrack=this._onRemoteStreamAdded.bind(this),this._pc.onremovestream=this._onRemoteStreamRemoved.bind(this),this._pc.onsignalingstatechange=this._onSignalingStateChanged.bind(this),this._pc.oniceconnectionstatechange=this._onIceConnectionStateChanged.bind(this),void(this._pc.onnegotiationneeded=this._onNegotiationNeeded.bind(this))):void d("_bind() - no PeerConnection")},h._unbind=function(){return s("_unbind()"),this._pc?(this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.onremovestream=null,this._pc.onsignalingstatechange=null,this._pc.oniceconnectionstatechange=null,void(this._pc.onnegotiationneeded=null)):void c("_unbind() - no PeerConnection")},h._setLocalDescription=function(e){var t,r=this;try{this._params.sdpPatches&&!this._params.sdpPatches.preventReplaceSendReceive&&(e.sdp=this._replaceSendReceive(e.sdp,this._params.send,this._params.receive)),e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params)}catch(e){return s("_setLocalDescription: error: "+e),Promise.reject(e)}return this._pc.setLocalDescription(e).then(function(){return u("setLocalDescription success."),t={sdp:e.sdp,type:e.type}}).catch(function(e){r._onError("_setLocalDescription",e)})},h._buildConstraints=function(e){return mergeConstraints(e,v)},h._adjustRemoteDescription=function(e){return e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params),e.sdp=maybePreferVideoSendCodec(e.sdp,this._params),this._params.videoSendBitrate&&(e.sdp=maybeSetVideoSendBitRate(e.sdp,this._params)),this._params.videoSendInitialBitrate&&(e.sdp=maybeSetVideoSendInitialBitRate(e.sdp,this._params)),e},h._drainMessageQueue=function(){var e,t;if(this._pc&&this._started&&this._hasRemoteSdp){for(e=0,t=this._messageQueue.length;e<t;e++)this._processSignalingMessage(this._messageQueue[e]);this._messageQueue=[]}},h._processSignalingMessage=function(e){if(s(e),"offer"!==e.type||this._isInitiator)if("answer"===e.type&&this._isInitiator){if(s("received answer"),"have-local-offer"!==this._pc.signalingState)return void s("MSG: ERROR: remote answer received in unexpected state: "+this._pc.signalingState);this._setRemoteSdp(e)}else if(e.candidate||"candidate"===e.type){s("new ice candidate");var t=new RTCIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate});this._recordIceCandidate("Remote",t);var r=this;this._pc.addIceCandidate(t).then(function(){s("MSG: Remote candidate added successfully.")}).catch(function(e){r._onError("addIceCandidate",e)})}else c("unexpected message: "+l(e));else{if(s("received offer"),"stable"!==this._pc.signalingState)return void s("ERROR: remote offer received in unexpected state: "+this._pc.signalingState);this._setRemoteSdp(e),this.doAnswer()}},h._onIceCandidate=function(e){var t=e.candidate;return t?void(this._isValidIceCandidate(t)&&(this.emitSimple("SignalingMessage",{sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}),this._recordIceCandidate("Local",t))):(s("_onIceCandidate - end of candidates"),void this.emitSimple("EndOfLocalCandidates",{}))},h._isValidIceCandidate=function(e){var t=e.candidate;return t.indexOf("tcp")===-1&&("relay"!==this._params.peerConnectionConfig.iceTransports||"relay"===iceCandidateType(t))},h._onSignalingStateChanged=function(){return!!this._pc&&(s("Signaling state changed to: "+this._pc.signalingState),void this.emitSimple("SignalingStateChanged",{state:this._pc.signalingState}))},h._onIceConnectionStateChanged=function(){return!!this._pc&&("completed"===this._pc.iceConnectionState&&s("ICE complete time: "+(window.performance.now()-this._startTime).toFixed(0)+"ms."),s("ICE connection state changed to: "+this._pc.iceConnectionState),void this.emitSimple("IceConnectionStateChange",{state:this._pc.iceConnectionState}))},h._onNegotiationNeeded=function(e){return!!this._pc&&(s("NegotiationNeeded Event"),void this.emitSimple("NegotiationNeeded",e))},h._recordIceCandidate=function(e,t){s("New ICE candidate for "+e),this.emitSimple("NewIceCandidate",{location:e,candidate:t})},h._onRemoteStreamAdded=function(e){s("Remote stream added to peer connection"),this.emitSimple("RemoteStreamAdded",{stream:e.streams[0]})},h._onRemoteStreamRemoved=function(e){s("Remote stream removed from peer connection"),this.emitSimple("RemoteStreamRemoved",{stream:e.stream})},h._onError=function(e,t){d('Error in "'+e+'": '+t.toString()),this.emitSimple("PeerConnectionError",{tag:e,error:t.toString()})},h._replaceSendReceive=function(e,t,r){var n,i,o="";t&&r?o="a=sendrecv":t?o="a=sendonly":r&&(o="a=recvonly");var a,s=e.split("\r\n");for(n=0,i=s.length;n<i;n++)a=s[n],a.indexOf("a=sendrecv")===-1&&a.indexOf("a=sendonly")===-1&&a.indexOf("a=recvonly")===-1||(s[n]=o);return s.join("\r\n")},o}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(16)],i=function(e){window.trace=function(e){if("\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),window.performance){var t=(window.performance.now()/1e3).toFixed(3);console.log(t+": "+e)}else console.log(e)}}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t){"use strict";window.mergeConstraints=function(e,t){if(!e||!t)return e||t;var r=e;for(var n in t)r[n]=t[n];return r},window.iceCandidateType=function(e){return e.split(" ")[7]},window.formatTypePreference=function(e){if("chrome"===adapter.browserDetails.browser)switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if("firefox"===adapter.browserDetails.browser)switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},window.maybeSetOpusOptions=function(e,t){return"true"===t.opusStereo?e=setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},window.maybeSetAudioSendBitRate=function(e,t){return t.audioSendBitrate?(trace("Prefer audio send bitrate: "+t.audioSendBitrate),preferBitRate(e,t.audioSendBitrate,"audio")):e},window.maybeSetAudioReceiveBitRate=function(e,t){return t.audioRecvBitrate?(trace("Prefer audio receive bitrate: "+t.audioRecvBitrate),preferBitRate(e,t.audioRecvBitrate,"audio")):e},window.maybeSetVideoSendBitRate=function(e,t){return t.videoSendBitrate?(trace("Prefer video send bitrate: "+t.videoSendBitrate),preferBitRate(e,t.videoSendBitrate,"video")):e},window.maybeSetVideoReceiveBitRate=function(e,t){return t.videoRecvBitrate?(trace("Prefer video receive bitrate: "+t.videoRecvBitrate),preferBitRate(e,t.videoRecvBitrate,"video")):e},window.preferBitRate=function(e,t,r){var n=e.split("\r\n"),i=findLine(n,"m=",r);if(null===i)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;var o=findLineInRange(n,i+1,-1,"m=");null===o&&(o=n.length);var a=findLineInRange(n,i+1,o,"c=");if(null===a)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=findLineInRange(n,a+1,o,"b=AS");s&&n.splice(s,1);var c="b=AS:"+t;return n.splice(a+1,0,c),e=n.join("\r\n")},window.maybeSetVideoSendInitialBitRate=function(e,t){var r=t.videoSendInitialBitrate;if(!r)return e;var n=r,i=t.videoSendBitrate;i&&(r>i&&(trace("Clamping initial bitrate to max bitrate of "+i+" kbps."),r=i,t.videoSendInitialBitrate=r),n=i);var o=e.split("\r\n"),a=findLine(o,"m=","video");if(null===a)return trace("Failed to find video m-line"),e;var s=t.videoRecvCodec;return e=setCodecParam(e,s,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=setCodecParam(e,s,"x-google-max-bitrate",n.toString())},window.removePayloadTypeFromMline=function(e,t){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]===t.toString()&&e.splice(r,1);return e.join(" ")},window.removeCodecByName=function(e,t){var r=findLine(e,"a=rtpmap",t);if(null===r)return e;var n=getCodecPayloadTypeFromLine(e[r]);e.splice(r,1);var i=findLine(e,"m=","video");return null===i?e:(e[i]=removePayloadTypeFromMline(e[i],n),e)},window.removeCodecByPayloadType=function(e,t){var r=findLine(e,"a=rtpmap",t.toString());if(null===r)return e;e.splice(r,1);var n=findLine(e,"m=","video");return null===n?e:(e[n]=removePayloadTypeFromMline(e[n],t),e)},window.maybeRemoveVideoFec=function(e,t){if("false"!==t.videoFec)return e;var r=e.split("\r\n"),n=findLine(r,"a=rtpmap","red");if(null===n)return e;var i=getCodecPayloadTypeFromLine(r[n]);if(r=removeCodecByPayloadType(r,i),r=removeCodecByName(r,"ulpfec"),n=findLine(r,"a=fmtp",i.toString()),null===n)return e;var o=parseFmtpLine(r[n]),a=o.pt;return null===a?e:(r.splice(n,1),r=removeCodecByPayloadType(r,a),r.join("\r\n"))},window.maybePreferAudioSendCodec=function(e,t){return maybePreferCodec(e,"audio","send",t.audioSendCodec)},window.maybePreferAudioReceiveCodec=function(e,t){return maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},window.maybePreferVideoSendCodec=function(e,t){return maybePreferCodec(e,"video","send",t.videoSendCodec)},window.maybePreferVideoReceiveCodec=function(e,t){return maybePreferCodec(e,"video","receive",t.videoRecvCodec)},window.maybePreferCodec=function(e,t,r,n){var i=t+" "+r+" codec";if(!n)return trace("No preference on "+i+"."),e;trace("Prefer "+i+": "+n);var o=e.split("\r\n"),a=findLine(o,"m=",t);if(null===a)return e;var s=getCodecPayloadType(o,n);return s&&(o[a]=setDefaultCodec(o[a],s)),e=o.join("\r\n")},window.setCodecParam=function(e,t,r,n){var i=e.split("\r\n"),o=findFmtpLine(i,t),a={};if(null===o){var s=findLine(i,"a=rtpmap",t);if(null===s)return e;var c=getCodecPayloadTypeFromLine(i[s]);a.pt=c.toString(),a.params={},a.params[r]=n,i.splice(s+1,0,writeFmtpLine(a))}else a=parseFmtpLine(i[o]),a.params[r]=n,i[o]=writeFmtpLine(a);return e=i.join("\r\n")},window.removeCodecParam=function(e,t,r){var n=e.split("\r\n"),i=findFmtpLine(n,t);if(null===i)return e;var o=parseFmtpLine(n[i]);delete o.params[r];var a=writeFmtpLine(o);return null===a?n.splice(i,1):n[i]=a,e=n.join("\r\n")},window.parseFmtpLine=function(e){var t={},r=e.indexOf(" "),n=e.substring(r+1).split("; "),i=new RegExp("a=fmtp:(\\d+)"),o=e.match(i);if(!o||2!==o.length)return null;t.pt=o[1];for(var a={},s=0;s<n.length;++s){var c=n[s].split("=");2===c.length&&(a[c[0]]=c[1])}return t.params=a,t},window.writeFmtpLine=function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,r=e.params,n=[],i=0;for(var o in r)n[i]=o+"="+r[o],++i;return 0===i?null:"a=fmtp:"+t.toString()+" "+n.join("; ")},window.findFmtpLine=function(e,t){var r=getCodecPayloadType(e,t);return r?findLine(e,"a=fmtp:"+r.toString()):null},window.findLine=function(e,t,r){return findLineInRange(e,0,-1,t,r)},window.findLineInRange=function(e,t,r,n,i){for(var o=r!==-1?r:e.length,a=t;a<o;++a)if(0===e[a].indexOf(n)&&(!i||e[a].toLowerCase().indexOf(i.toLowerCase())!==-1))return a;return null},window.getCodecPayloadType=function(e,t){var r=findLine(e,"a=rtpmap",t);return r?getCodecPayloadTypeFromLine(e[r]):null},window.getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},window.setDefaultCodec=function(e,t){var r=e.split(" "),n=r.slice(0,3);n.push(t);for(var i=3;i<r.length;i++)r[i]!==t&&n.push(r[i]);return n.join(" ")}},function(e,t,r){var n,n;!function(t){e.exports=t()}(function(){return function(){function e(t,r,i){function o(s,c){if(!r[s]){if(!t[s]){var d="function"==typeof n&&n;if(!c&&d)return n(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[s]={exports:{}};t[s][0].call(p.exports,function(e){var r=t[s][1][e];return o(r||e)},p,p.exports,e,t,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}return e}()({1:[function(e,t,r){"use strict";var n=e("./adapter_factory.js"),i=(0,n.adapterFactory)({window:window});t.exports=i},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=a.log,i=a.detectBrowser(t),o={browserDetails:i,commonShim:h,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings};switch(i.browser){case"chrome":if(!c||!c.shimPeerConnection||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),o;n("adapter.js shimming chrome."),o.browserShim=c,c.shimGetUserMedia(t),c.shimMediaStream(t),c.shimPeerConnection(t),c.shimOnTrack(t),c.shimAddTrackRemoveTrack(t),c.shimGetSendersWithDtmf(t),c.shimSenderReceiverGetStats(t),c.fixNegotiationNeeded(t),h.shimRTCIceCandidate(t),h.shimConnectionState(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t);break;case"firefox":if(!l||!l.shimPeerConnection||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=l,l.shimGetUserMedia(t),l.shimPeerConnection(t),l.shimOnTrack(t),l.shimRemoveStream(t),l.shimSenderGetStats(t),l.shimReceiverGetStats(t),l.shimRTCDataChannel(t),h.shimRTCIceCandidate(t),h.shimConnectionState(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t);break;case"edge":if(!u||!u.shimPeerConnection||!r.shimEdge)return n("MS edge shim is not included in this adapter release."),o;n("adapter.js shimming edge."),o.browserShim=u,u.shimGetUserMedia(t),u.shimGetDisplayMedia(t),u.shimPeerConnection(t),u.shimReplaceTrack(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t);break;case"safari":if(!f||!r.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=f,f.shimRTCIceServerUrls(t),f.shimCreateOfferLegacy(t),f.shimCallbacksAPI(t),f.shimLocalStreamsAPI(t),f.shimRemoteStreamsAPI(t),f.shimTrackEventTransceiver(t),f.shimGetUserMedia(t),h.shimRTCIceCandidate(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t);break;default:n("Unsupported browser!")}return o}Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=i;var o=e("./utils"),a=n(o),s=e("./chrome/chrome_shim"),c=n(s),d=e("./edge/edge_shim"),u=n(d),p=e("./firefox/firefox_shim"),l=n(p),m=e("./safari/safari_shim"),f=n(m),v=e("./common_shim"),h=n(v)},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?i(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){i(e,e.get(t),r)})}))}function o(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var a=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&i(e,r,o)})}),o}function a(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function s(e){if("object"!==("undefined"==typeof e?"undefined":f(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)_.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function c(e){if("object"===("undefined"==typeof e?"undefined":f(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);t!==-1&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===("undefined"==typeof e?"undefined":f(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function d(e){if("object"===("undefined"==typeof e?"undefined":f(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),_.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,o=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?o=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?o=!0:n=e),e.track===t}),o||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function u(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?this._shimmedLocalStreams[r.id].indexOf(n)===-1&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});if(r)throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return n.indexOf(e)===-1});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);n!==-1&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}function p(e){function t(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function r(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}if(e.RTCPeerConnection){var n=_.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return u(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}o.apply(this,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[r.id];if(a)a.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(r){var n=e.RTCPeerConnection.prototype[r];e.RTCPeerConnection.prototype[r]=function(){var e=this,r=arguments,i=arguments.length&&"function"==typeof arguments[0];return i?n.apply(this,[function(n){var i=t(e,n);r[0].apply(null,[i])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(function(r){return t(e,r)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=r(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r=e._pc===this;if(!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(r){var i=t._streams[r].getTracks().find(function(t){return e.track===t});i&&(n=t._streams[r])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function l(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var a=function(e){var t={},r=e.result();return r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){
return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return t.apply(this,[c,arguments[0]])}return new Promise(function(e,r){t.apply(i,[function(t){e(s(a(t)))},r])}).then(r,n)},["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function m(e){_.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if("stable"===t.signalingState)return e})}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return v.shimGetUserMedia}});var h=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return h.shimGetDisplayMedia}}),r.shimMediaStream=a,r.shimOnTrack=s,r.shimGetSendersWithDtmf=c,r.shimSenderReceiverGetStats=d,r.shimAddTrackRemoveTrackWithNative=u,r.shimAddTrackRemoveTrack=p,r.shimPeerConnection=l,r.fixNegotiationNeeded=m;var g=e("../utils.js"),_=n(g)},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices)return"function"!=typeof t?void console.error("shimGetDisplayMedia: getSourceId argument is not a function"):void(e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})})}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],5:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){var t=e&&e.navigator;if(t.mediaDevices){var r=s.detectBrowser(e),n=function(e){if("object"!==("undefined"==typeof e?"undefined":o(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===o(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var a={};"number"==typeof n.ideal?(a[i("min",r)]=n.ideal,t.optional.push(a),a={},a[i("max",r)]=n.ideal,t.optional.push(a)):(a[i("",r)]=n.ideal,t.optional.push(a))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(r.version>=61)return i(e);if(e=JSON.parse(JSON.stringify(e)),e&&"object"===o(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===o(e.video)){var s=e.video.facingMode;s=s&&("object"===("undefined"==typeof s?"undefined":o(s))?s:{ideal:s});var d=r.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var u=void 0;if("environment"===s.exact||"environment"===s.ideal?u=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(u=["front"]),u)return t.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var r=t.find(function(e){return u.some(function(t){return e.label.toLowerCase().includes(t)})});return!r&&t.length&&u.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),c("chrome: "+JSON.stringify(e)),i(e)})}e.video=n(e.video)}return c("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},d=function(e,r,n){i(e,function(e){t.webkitGetUserMedia(e,r,function(e){n&&n(a(e))})})};t.getUserMedia=d.bind(t);var u=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(a(e))})})}}}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=i;var a=e("../utils.js"),s=n(a),c=s.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===("undefined"==typeof e?"undefined":d(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),n=p.default.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,m.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}}function a(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=m.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp}});var r=function(e){var t=p.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=p.default.parseMLine(e);return t&&"application"===t.kind&&t.protocol.indexOf("SCTP")!==-1})},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!==r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?e===-1?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},o=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=p.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&r!==-1&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r(arguments[0])){var e=n(arguments[0]),t=i(e),s=o(arguments[0],e),c=void 0;c=0===t&&0===s?Number.POSITIVE_INFINITY:0===t||0===s?Math.max(t,s):Math.min(t,s);var d={};Object.defineProperty(d,"maxMessageSize",{get:function(){return c}}),this._sctp=d}return a.apply(this,arguments)}}}function s(e){function t(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=r.apply(this,arguments);return t(e,this),e},m.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})}}function c(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}}Object.defineProperty(r,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=o,r.shimMaxMessageSize=a,r.shimSendThrowTypeError=s,r.shimConnectionState=c;var u=e("sdp"),p=i(u),l=e("./utils"),m=n(l)},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){var t=u.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,m.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,p.filterIceServers)(e.iceServers,t.version),u.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function a(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var s=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var c=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return c.shimGetDisplayMedia}}),r.shimPeerConnection=o,r.shimReplaceTrack=a;var d=e("../utils"),u=i(d),p=e("./filtericeservers"),l=e("rtcpeerconnection-shim"),m=n(l)},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&a.deprecated("RTCIceServer.url","RTCIceServer.urls");var n="string"==typeof t;return n&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r}),delete e.url,e.urls=n?t[0]:t,!!t.length}})}Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=i;var o=e("../utils"),a=n(o)},{"../utils":15}],9:[function(e,t,r){"use strict";function n(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator.mediaDevices)))}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],10:[function(e,t,r){"use strict";function n(e){var t=e&&e.navigator,r=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(r(e))})}}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=n},{}],11:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){"object"===("undefined"==typeof e?"undefined":u(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function o(e){var t=f.detectBrowser(e);if("object"===("undefined"==typeof e?"undefined":u(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,o){return i.apply(this,[e||null]).then(function(e){if(t.version<53&&!r)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(r,o)}}}function a(e){if("object"===("undefined"==typeof e?"undefined":u(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function s(e){if("object"===("undefined"==typeof e?"undefined":u(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r}),f.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function c(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;f.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)})})}function d(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return p.shimGetUserMedia}});var l=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return l.shimGetDisplayMedia}}),r.shimOnTrack=i,r.shimPeerConnection=o,r.shimSenderGetStats=a,r.shimReceiverGetStats=s,r.shimRemoveStream=c,r.shimRTCDataChannel=d;var m=e("../utils"),f=n(m)},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";function n(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],13:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){var t=s.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){s.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===("undefined"==typeof e?"undefined":o(e))&&"object"===o(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},n&&n.prototype.getSettings){var c=n.prototype.getSettings;n.prototype.getSettings=function(){var e=c.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var d=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===("undefined"==typeof e?"undefined":o(e))&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=i;var a=e("../utils"),s=n(a)},{"../utils":15}],14:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){if("object"===("undefined"==typeof e?"undefined":p(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach(function(n){return t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(r!==-1){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)})}})}}function o(e){if("object"===("undefined"==typeof e?"undefined":p(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}}function a(e){if("object"===("undefined"==typeof e?"undefined":p(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}}function s(e){var t=e&&e.navigator;!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function c(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(m.deprecated("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}function d(e){"object"===("undefined"==typeof e?"undefined":p(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function u(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!=typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});e.offerToReceiveAudio===!1&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):e.offerToReceiveAudio!==!0||r||this.addTransceiver("audio"),"undefined"!=typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});e.offerToReceiveVideo===!1&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):e.offerToReceiveVideo!==!0||n||this.addTransceiver("video")}return t.apply(this,arguments)}}Object.defineProperty(r,"__esModule",{value:!0});var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=i,r.shimRemoteStreamsAPI=o,r.shimCallbacksAPI=a,r.shimGetUserMedia=s,r.shimRTCIceServerUrls=c,r.shimTrackEventTransceiver=d,r.shimCreateOfferLegacy=u;var l=e("../utils"),m=n(l)},{"../utils":15}],15:[function(e,t,r){"use strict";function n(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function i(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function o(e){return"boolean"!=typeof e?new Error("Argument type: "+("undefined"==typeof e?"undefined":u(e))+". Please use a boolean."):(p=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function a(e){return"boolean"!=typeof e?new Error("Argument type: "+("undefined"==typeof e?"undefined":u(e))+". Please use a boolean."):(l=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function s(){if("object"===("undefined"==typeof window?"undefined":u(window))){if(p)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function c(e,t){l&&console.warn(e+" is deprecated, please use "+t+" instead.")}function d(e){var t=e.navigator,r={browser:null,version:null};if("undefined"==typeof e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}Object.defineProperty(r,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=n,r.wrapPeerConnectionEvent=i,r.disableLog=o,r.disableWarnings=a,r.log=s,r.deprecated=c,r.detectBrowser=d;var p=!0,l=!0},{}],16:[function(e,t,r){"use strict";function n(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function i(e,t,r,n,i){var o=u.writeRtpDescription(e.kind,t);if(o+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(n?n.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),o}function o(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){var n=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!r;return n?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&e.indexOf("?transport=udp")===-1}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}function a(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),a=n(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!i(n,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){
for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function s(e,t,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)!==-1}function c(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function d(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var u=e("sdp");t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function p(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function l(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var m=function(r){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw d("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=o(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=u.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(m.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(m.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),m.prototype.onicecandidate=null,m.prototype.onaddstream=null,m.prototype.ontrack=null,m.prototype.onremovestream=null,m.prototype.onsignalingstatechange=null,m.prototype.oniceconnectionstatechange=null,m.prototype.onconnectionstatechange=null,m.prototype.onicegatheringstatechange=null,m.prototype.onnegotiationneeded=null,m.prototype.ondatachannel=null,m.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},m.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},m.prototype.getConfiguration=function(){return this._config},m.prototype.getLocalStreams=function(){return this.localStreams},m.prototype.getRemoteStreams=function(){return this.remoteStreams},m.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},m.prototype.addTrack=function(t,r){if(this._isClosed)throw d("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n=this.transceivers.find(function(e){return e.track===t});if(n)throw d("InvalidAccessError","Track already exists.");for(var i,o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(i=this.transceivers[o]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(r)===-1&&this.localStreams.push(r),i.track=t,i.stream=r,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},m.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},m.prototype.removeTrack=function(t){if(this._isClosed)throw d("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw d("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null;var i=this.transceivers.map(function(e){return e.stream});i.indexOf(n)===-1&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},m.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},m.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},m.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},m.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},m.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var c=u.writeCandidate(a);o.candidate=Object.assign(o.candidate,u.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=u.getMediaSections(n._localDescription.sdp);s?d[o.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n":d[o.candidate.sdpMLineIndex]+="a="+o.candidate.candidate+"\r\n",n._localDescription.sdp=u.getDescription(n._localDescription.sdp)+d.join("");var p=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),s||n._dispatchEvent("icecandidate",o),p&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},m.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},m.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},m.prototype._transceive=function(e,r,n){var i=a(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:u.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},m.prototype.setLocalDescription=function(e){var t=this;if(["offer","answer"].indexOf(e.type)===-1)return Promise.reject(d("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(d("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));var r,n;if("offer"===e.type)r=u.splitSections(e.sdp),n=r.shift(),r.forEach(function(e,r){var n=u.parseRtpParameters(e);t.transceivers[r].localCapabilities=n}),t.transceivers.forEach(function(e,r){t._gather(e.mid,r)});else if("answer"===e.type){r=u.splitSections(t._remoteDescription.sdp),n=r.shift();var i=u.matchPrefix(n,"a=ice-lite").length>0;r.forEach(function(e,r){var o=t.transceivers[r],s=o.iceGatherer,c=o.iceTransport,d=o.dtlsTransport,p=o.localCapabilities,l=o.remoteCapabilities,m=u.isRejected(e)&&0===u.matchPrefix(e,"a=bundle-only").length;if(!m&&!o.rejected){var f=u.getIceParameters(e,n),v=u.getDtlsParameters(e,n);i&&(v.role="server"),t.usingBundle&&0!==r||(t._gather(o.mid,r),"new"===c.state&&c.start(s,f,i?"controlling":"controlled"),"new"===d.state&&d.start(v));var h=a(p,l);t._transceive(o,h.codecs.length>0,!1)}})}return t._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve()},m.prototype.setRemoteDescription=function(n){var i=this;if(["offer","answer"].indexOf(n.type)===-1)return Promise.reject(d("TypeError",'Unsupported type "'+n.type+'"'));if(!s("setRemoteDescription",n.type,i.signalingState)||i._isClosed)return Promise.reject(d("InvalidStateError","Can not set remote "+n.type+" in state "+i.signalingState));var o={};i.remoteStreams.forEach(function(e){o[e.id]=e});var m=[],f=u.splitSections(n.sdp),v=f.shift(),h=u.matchPrefix(v,"a=ice-lite").length>0,g=u.matchPrefix(v,"a=group:BUNDLE ").length>0;i.usingBundle=g;var _=u.matchPrefix(v,"a=ice-options:")[0];return _?i.canTrickleIceCandidates=_.substr(14).split(" ").indexOf("trickle")>=0:i.canTrickleIceCandidates=!1,f.forEach(function(s,d){var l=u.splitLines(s),f=u.getKind(s),_=u.isRejected(s)&&0===u.matchPrefix(s,"a=bundle-only").length,S=l[0].substr(2).split(" ")[2],y=u.getDirection(s,v),C=u.parseMsid(s),E=u.getMid(s)||u.generateIdentifier();if(_||"application"===f&&("DTLS/SCTP"===S||"UDP/DTLS/SCTP"===S))return void(i.transceivers[d]={mid:E,kind:f,protocol:S,rejected:!0});!_&&i.transceivers[d]&&i.transceivers[d].rejected&&(i.transceivers[d]=i._createTransceiver(f,!0));var b,T,P,R,I,w,N,M,D,O,k,x=u.parseRtpParameters(s);_||(O=u.getIceParameters(s,v),k=u.getDtlsParameters(s,v),k.role="client"),N=u.parseRtpEncodingParameters(s);var A=u.parseRtcpParameters(s),L=u.matchPrefix(s,"a=end-of-candidates",v).length>0,j=u.matchPrefix(s,"a=candidate:").map(function(e){return u.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!_&&g&&d>0&&i.transceivers[d]&&(i._disposeIceAndDtlsTransports(d),i.transceivers[d].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[d].iceTransport=i.transceivers[0].iceTransport,i.transceivers[d].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[d].rtpSender&&i.transceivers[d].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[d].rtpReceiver&&i.transceivers[d].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==n.type||_){if("answer"===n.type&&!_){b=i.transceivers[d],T=b.iceGatherer,P=b.iceTransport,R=b.dtlsTransport,I=b.rtpReceiver,w=b.sendEncodingParameters,M=b.localCapabilities,i.transceivers[d].recvEncodingParameters=N,i.transceivers[d].remoteCapabilities=x,i.transceivers[d].rtcpParameters=A,j.length&&"new"===P.state&&(!h&&!L||g&&0!==d?j.forEach(function(e){c(b.iceTransport,e)}):P.setRemoteCandidates(j)),g&&0!==d||("new"===P.state&&P.start(T,O,"controlling"),"new"===R.state&&R.start(k));var B=a(b.localCapabilities,b.remoteCapabilities),U=B.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!U&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,i._transceive(b,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!I||"sendrecv"!==y&&"sendonly"!==y?delete b.rtpReceiver:(D=I.track,C?(o[C.stream]||(o[C.stream]=new e.MediaStream),r(D,o[C.stream]),m.push([D,I,o[C.stream]])):(o.default||(o.default=new e.MediaStream),r(D,o.default),m.push([D,I,o.default])))}}else{b=i.transceivers[d]||i._createTransceiver(f),b.mid=E,b.iceGatherer||(b.iceGatherer=i._createIceGatherer(d,g)),j.length&&"new"===b.iceTransport.state&&(!L||g&&0!==d?j.forEach(function(e){c(b.iceTransport,e)}):b.iceTransport.setRemoteCandidates(j)),M=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(M.codecs=M.codecs.filter(function(e){return"rtx"!==e.name})),w=b.sendEncodingParameters||[{ssrc:1001*(2*d+2)}];var V=!1;if("sendrecv"===y||"sendonly"===y){if(V=!b.rtpReceiver,I=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,f),V){var F;D=I.track,C&&"-"===C.stream||(C?(o[C.stream]||(o[C.stream]=new e.MediaStream,Object.defineProperty(o[C.stream],"id",{get:function(){return C.stream}})),Object.defineProperty(D,"id",{get:function(){return C.track}}),F=o[C.stream]):(o.default||(o.default=new e.MediaStream),F=o.default)),F&&(r(D,F),b.associatedRemoteMediaStreams.push(F)),m.push([D,I,F])}}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===b.rtpReceiver.track.id});t&&p(t,e)}),b.associatedRemoteMediaStreams=[]);b.localCapabilities=M,b.remoteCapabilities=x,b.rtpReceiver=I,b.rtcpParameters=A,b.sendEncodingParameters=w,b.recvEncodingParameters=N,i._transceive(i.transceivers[d],!1,V)}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===n.type?"active":"passive"),i._remoteDescription={type:n.type,sdp:n.sdp},"offer"===n.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var r=o[t];if(r.getTracks().length){if(i.remoteStreams.indexOf(r)===-1){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){i._dispatchEvent("addstream",n)})}m.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&l(i,t,n,[r])})}}),m.forEach(function(e){e[2]||l(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},m.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},m.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},m.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},m.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},m.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},m.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(d("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter(function(e){return"audio"===e.kind}).length,o=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(n=a.offerToReceiveAudio===!0?1:a.offerToReceiveAudio===!1?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=a.offerToReceiveVideo===!0?1:a.offerToReceiveVideo===!1?0:a.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?(n--,n<0&&(e.wantReceive=!1)):"video"===e.kind&&(o--,o<0&&(e.wantReceive=!1))});n>0||o>0;)n>0&&(r._createTransceiver("audio"),n--),o>0&&(r._createTransceiver("video"),o--);var s=u.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(n,i){var o=n.track,a=n.kind,s=n.mid||u.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){var t=n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[];t.forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=c,n.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){s+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+u.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(c)},m.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(d("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(d("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=u.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var o=u.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,s){if(!(s+1>o)){if(e.rejected)return"application"===e.kind?n+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var d=a(e.localCapabilities,e.remoteCapabilities),u=d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!u&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=i(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(s)},m.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(n,i){if(!r._remoteDescription)return i(d("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<r.transceivers.length;a++)if(r.transceivers[a].mid===e.sdpMid){o=a;break}var s=r.transceivers[o];if(!s)return i(d("OperationError","Can not add ICE candidate"));if(s.rejected)return n();var p=Object.keys(e.candidate).length>0?u.parseCandidate(e.candidate):{};if("tcp"===p.protocol&&(0===p.port||9===p.port))return n();if(p.component&&1!==p.component)return n();if((0===o||o>0&&s.iceTransport!==r.transceivers[0].iceTransport)&&!c(s.iceTransport,p))return i(d("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),t=u.getMediaSections(r._remoteDescription.sdp),t[o]+="a="+(p.type?l:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=u.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var m=0;m<r.transceivers.length&&(r.transceivers[m].rejected||(r.transceivers[m].iceTransport.addRemoteCandidate({}),t=u.getMediaSections(r._remoteDescription.sdp),t[m]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=u.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));m++);n()})},m.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw d("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};var f=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];f.forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var i=r.prototype.getStats;r.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=n(e[r]),t.set(r,e[r])}),t})}}});var v=["createOffer","createAnswer"];return v.forEach(function(e){var t=m.prototype[e];m.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),v=["setLocalDescription","setRemoteDescription","addIceCandidate"],v.forEach(function(e){var t=m.prototype[e];m.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=m.prototype[e];m.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),m}},{sdp:17}],17:[function(e,t,r){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)t=n[i].trim().split("="),r[t[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){var r=n.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var i={usernameFragment:r.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return i},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e),i=r[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=n.parseRtpMap(s),d=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=d.length?n.parseFmtp(d[0]):{},c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),
r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var u=n.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=u})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i,o=void 0!==t?t:2;i=e?e:n.generateSessionId();var a=r||"thisisadapterortc";return"v=0\r\no="+a+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){var t=n.splitLines(e),r=t[0].split(" ");return r[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e),r=t[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0],r=t.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}]},{},[1])(1)})},function(e,t,r){var n,i;n=[r(4),r(9)],i=function(e,t){"use strict";function r(){t.call(this),this.keysChromeEncoding=["googCodecName","googFrameWidthSent","googFrameHeightSent","googFrameRateInput","googFrameRateSent"],this.keysChromeBandwidth=["googActualEncBitrate","googAvailableReceiveBandwidth","googAvailableSendBandwidth","googTargetEncBitrate","googTransmitBitrate"],this.videoTimestampPrev=null,this.videoFramesPrev=null,this.videoBytesPrev=0,this.audioTimestampPrev=null,this.audioBytesPrev=0}var n=e.debug_,i=e.isBool,o=e.isObject,a=r.prototype=Object.create(t.prototype);return a.putReport=function(e,t){var n=this._filterReport(e,t),i=r._formatResults(n);this.emitSimple("ReceivedWebRTCStats",{results:i})},a._filterReport=function(t,r){var n={},i=e.browserInfo.browser;switch(i){case"Firefox":n=this._filterStatsFirefox(t);break;case"Chrome":n=t.get("bweforvideo")?this._filterStatsChromeOld(t):this._filterStatsChrome(t,r);break;case"Microsoft Edge":n=this._filterStatsEdge(t,r);break;case"Safari":n=this._filterStatsSafari(t)}return n},a._filterStatsFirefox=function(e){if(o(e)){var t={},r=this;return e.forEach(function(e){if("outbound-rtp"===e.type&&"video"===e.mediaType){var n=e.timestamp;if(e.bytesSent){var i=e.bytesSent;if(r.videoTimestampPrev){var o=8*(i-r.videoBytesPrev)/(n-r.videoTimestampPrev);t["video bitrate"]=1e3*o}r.videoBytesPrev=i}if(e.framesEncoded){var a=e.framesEncoded;if(r.videoTimestampPrev){var s=1e3*(e.framesEncoded-r.videoFramesPrev)/(n-r.videoTimestampPrev);t.framerate=s}r.videoFramesPrev=a}r.videoTimestampPrev=n}if("outbound-rtp"===e.type&&"audio"===e.mediaType){var n=e.timestamp;if(e.bytesSent){var i=e.bytesSent;if(r.audioTimestampPrev){var o=8*(i-r.audioBytesPrev)/(n-r.audioTimestampPrev);t["audio bitrate"]=1e3*o}r.audioBytesPrev=i}r.audioTimestampPrev=n}}),t}},a._filterStatsChromeOld=function(e){if(o(e)){var t=e.get("bweforvideo"),r=this._filterKeys(t,this.keysChromeBandwidth);return r}},a._filterStatsChrome=function(e,t){if(o(e)){var r={},n=this;return e.forEach(function(i){if(!t||"video"===t){if("video"===i.kind&&"track"===i.type&&i.frameWidth&&(r.frameWidth=i.frameWidth,r.frameHeight=i.frameHeight),"outbound-rtp"===i.type&&"video"===i.mediaType&&i.codecId){var o=e.get(i.codecId),a=o.mimeType;r.codec=a}if("outbound-rtp"===i.type&&"video"===i.mediaType){var s=i.timestamp;if(i.bytesSent){var c=i.bytesSent;if(n.videoBytesPrev&&n.videoTimestampPrev){var d=8*(c-n.videoBytesPrev)/(s-n.videoTimestampPrev);r["video bitrate"]=1e3*d}n.videoBytesPrev=c}if(i.framesEncoded&&n.videoTimestampPrev){if(n.videoFramesPrev){var u=1e3*(i.framesEncoded-n.videoFramesPrev)/(s-n.videoTimestampPrev);r.framerate=u}n.videoFramesPrev=i.framesEncoded}n.videoTimestampPrev=s}}if((!t||"audio"===t)&&"outbound-rtp"===i.type&&"audio"===i.mediaType){var s=i.timestamp;if(i.bytesSent){var c=i.bytesSent;if(n.audioBytesPrev&&n.audioTimestampPrev){var d=8*(c-n.audioBytesPrev)/(s-n.audioTimestampPrev);r["audio bitrate"]=1e3*d}n.audioBytesPrev=c}n.audioTimestampPrev=s}}),r}},a._filterStatsEdge=function(e,t){if(o(e)){var r={};return e.forEach(function(e){t&&"video"!==t||(i(e.remoteSource)&&e.remoteSource===!1&&e.type&&"track"===e.type&&(r.framerate=e.framesPerSecond?e.framesPerSecond:"",r.frameWidth=e.frameWidth?e.frameWidth:"",r.frameHeight=e.frameHeight?e.frameHeight:""),i(e.isRemote)&&e.isRemote===!1&&e.type&&"outbound-rtp"===e.type&&e.mediaType&&"video"===e.mediaType&&(r["video codec"]=e.codecId?e.codecId:"")),t&&"audio"!==t||i(e.isRemote)&&e.isRemote===!1&&e.type&&"outbound-rtp"===e.type&&e.mediaType&&"audio"===e.mediaType&&(r["audio codec"]=e.codecId?e.codecId:"")}),r}},a._filterStatsSafari=function(e){if(o(e)){var t={},r=this;return e.forEach(function(e){if(e.id&&e.id.indexOf("RTCMediaStreamTrack_sender")!==-1&&"track"===e.type&&e.frameWidth&&(t.frameWidth=e.frameWidth,t.frameHeight=e.frameHeight),e.id&&e.id.indexOf("RTCOutboundRTPVideoStream")!==-1&&"outbound-rtp"===e.type&&e.codecId,e.id&&e.id.indexOf("RTCOutboundRTPVideoStream")!==-1&&"video"===e.mediaType){var n=e.timestamp;if(e.bytesSent){var i,o=e.bytesSent;r.videoTimestampPrev&&(i=8*(o-r.videoBytesPrev)/(n-r.videoTimestampPrev),t["video bitrate"]=1e3*i),r.videoBytesPrev=o}if(e.framesEncoded&&r.videoTimestampPrev){if(r.videoFramesPrev){var a=1e3*(e.framesEncoded-r.videoFramesPrev)/(n-r.videoTimestampPrev);t.framerate=a}r.videoFramesPrev=e.framesEncoded}r.videoTimestampPrev=n}if(e.id&&e.id.indexOf("RTCOutboundRTPAudioStream")!==-1&&"audio"===e.mediaType){var n=e.timestamp;if(e.bytesSent){var o=e.bytesSent;if(r.audioTimestampPrev){var i=8*(o-r.audioBytesPrev)/(n-r.audioTimestampPrev);t["audio bitrate"]=1e3*i}r.audioBytesPrev=o}r.audioTimestampPrev=n}}),t}},a._filterKeys=function(e,t,r){var i,o,a,s={},c="[BW]: ";for(i=0,o=t.length;i<o;i++)a=t[i],s[a]=e[a],c+=e[a]+",";return r&&n(c),s},r._formatResults=function(e){var t={};return Object.keys(e).forEach(function(n){Object.assign(t,r._formatEntry(n,e[n]))}),t},r._formatEntry=function(e,t){var r={};e.length>4&&"goog"===e.substring(0,4)&&(e=e.substring(4));var n=e.toLowerCase();return n.includes("framerate")?t=Math.round(10*t)/10+" fps":(n.includes("bitrate")||n.includes("bandwidth"))&&(t=Number(t)?Math.round(parseInt(t,10)/1e3)+"k":t),r[e]=t,r},r}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(9),r(4)],i=function(e,t){"use strict";function r(){e.call(this),this._name="AudioMixer",this._audioContext,this._streams=[],this._output}var n=t.isNumber,i=r.prototype=Object.create(e.prototype);return i.connect=function(e,t){if(!e||0===e.getAudioTracks().length)return Promise.reject(new Error(this._name+'.connect parameter "stream" must contain a AudioStreamTrack'));if(!n(t)||t>1)return Promise.reject(new Error(this._name+'.connect parameter "input" must be 0 or 1'));var r=e.clone();return this._streams[t]=r,this._listenToStream(r)},i.disconnect=function(e){},i.getOutputStream=function(){return this._streams.length<2?Promise.reject(new Error(this._name+" needs exactly 2 input streams")):this._getMixedStream()},i._listenToStream=function(e){return e.onactive=this._onactive.bind(this),e.oninactive=this._oninactive.bind(this),e.onaddtrack=this._onaddtrack.bind(this),e.onended=this._onended.bind(this),Promise.resolve()},i._unregisterAudioTrackListeners=function(e){},i._onactive=function(e){console.log(this._name+" - ONINACTIVE: "+e)},i._oninactive=function(e){console.log(this._name+" - ONINACTIVE: "+e)},i._onaddtrack=function(e){console.log(this._name+" - ONADDTRACK: "+e)},i._onended=function(e){console.log(this._name+" - ONLOAD: "+e)},i._getMixedStream=function(){this._audioContext||(this._audioContext=new AudioContext);var e=this._audioContext.createMediaStreamSource(this._streams[0]),t=this._audioContext.createMediaStreamSource(this._streams[1]),r=this._audioContext.createChannelSplitter(2),n=this._audioContext.createChannelSplitter(2);e.connect(r),t.connect(n);var i=this._audioContext.createChannelMerger(4);r.connect(i,0,0),r.connect(i,1,1),n.connect(i,0,2),n.connect(i,1,3);var o=this._createDownMixerNode();return i.connect(o),this._output=this._audioContext.createMediaStreamDestination(),o.connect(this._output),Promise.resolve(this._output.stream)},i._createDownMixerNode=function(){var e=this._audioContext.createScriptProcessor(4096,4,2);return e.onaudioprocess=function(e){for(var t,r=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),i=e.inputBuffer.getChannelData(2),o=e.inputBuffer.getChannelData(3),a=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1),c=0;c<r.length;c++)t=.25*(r[c]+n[c])+.25*(i[c]+o[c]),a[c]=t,s[c]=t},e},r}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(4),r(9),r(17)],i=function(e,t,r){"use strict";function n(e){t.call(this),this._screenCaptureName=e||"nanoScreenCapture",this._sourceId=null,this._screenConstraints="",this.width=0,this.height=0,this.maxWidth=1920,this.maxHeight=1080,this.framerate=3,this.isChromeScreenCaptureInstalled=!1,this.isAdapterInitialized=!1,this._onGetSourceId=null;var r=this;window.addEventListener("message",function(e){if(!r._isValidOrigin(e.origin)&&r._isValidType(e.data.type)&&e.data.command){if("message"===e.data.command){if("isReady"===e.data.value){r.isChromeScreenCaptureInstalled=!0;var t=r._screenCaptureName+" event screenCaptureAvailable / isReady";o(t)}else if("isLoaded"===e.data.value){r.isChromeScreenCaptureInstalled=!0;var t=r._screenCaptureName+"event screenCaptureAvailable / isLoaded";o(t)}}else if("error"===e.data.command){var t=r._screenCaptureName+" error: "+e.data.value;if(o(t),"PermissionDeniedError"===e.data.value){var n=r._addPayload();n.name="PermissionDenied",n.data.error="ScreenCapture (Chrome) - "+e.data.value,r.emit(n.name,n)}}else if("setSourceId"===e.data.command){var i=e.data.value,t=r._screenCaptureName+"event setSourceId";o(t),r._setSourceId(i)}r.isAdapterInitialized="getDisplayMedia"in navigator.mediaDevices}}),this._initAdapter()}var i=e.error_,o=e.debug_,a=e.isFunction,s=n.prototype=Object.create(t.prototype);return s._mediaId=String(""),s._mediaIndex=Number(-1),s.getScreenCaptureName=function(){return this._screenCaptureName},s.isScreenCaptureAvailable=function(){return"chrome"==r.browserDetails.browser?this.isChromeScreenCaptureInstalled&&this.isAdapterInitialized:this.isAdapterInitialized},s.getSourceId=function(e){a(e)&&(this._onGetSourceId=e,o(this._screenCaptureName+"getSourceId"),this._toWindow(this._screenCaptureName,"getSourceId",""))},s._initAdapter=function(){if("edge"==r.browserDetails.browser)return!1;if("firefox"==r.browserDetails.browser&&(r.browserShim.shimGetDisplayMedia(window,"screen"),this.isAdapterInitialized="getDisplayMedia"in navigator.mediaDevices),"chrome"==r.browserDetails.browser){this._checkChromeExtensionAliveness();var e=this;r.browserShim.shimGetDisplayMedia(window,function(){return new Promise(function(t,r){e.once("PermissionDenied",function(){var e='Failed to call "getDisplayMedia"',t="PermissionDenied",n=new Error(e);n.name=t;var e="ScreenCapture: _initAdapter: "+JSON.stringify(n);i(e),r(n)}),e.getSourceId(function(){if(e._sourceId)t(e._sourceId);else{var n='Failed to call "getDisplayMedia"',o="NotAllowedError",a=new Error(n);a.name=o;var n="ScreenCapture: _initAdapter: "+JSON.stringify(a);i(n),r(a)}})})})}},s._checkChromeExtensionAliveness=function(){if(null===this.isChromeScreenCaptureInstalled){var e=this;setTimeout(function(){e.isChromeScreenCaptureInstalled||(e.isChromeScreenCaptureInstalled=!1)},500)}o(this._screenCaptureName+"alive?"),this._toWindow(this._screenCaptureName,"isAlive","")},s._isValidOrigin=function(e){return e!==window.location.origin},s._isValidType=function(e){return e==this._screenCaptureName},s._setSourceId=function(e){"undefined"!=typeof e?this._sourceId=e:this._sourceId=null,this._onGetSourceId&&this._onGetSourceId()},s._toWindow=function(e,t,r){var n=this._screenCaptureName+" _toWindow --> { type: "+e+", command: "+t+", value: "+r+" }";o(n),window.postMessage({type:e,command:t,value:r},"*")},s._addPayload=function(e){return e=e||{},e.data={},e.data.mediaId=this._mediaId,e.data.mediaIndex=this._mediaIndex,e},n}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(11),r(3),r(9),r(4),r(22),r(2),r(8)],i=function(e,t,r,n,i,o,a){"use strict";function s(e){r.call(this),this._roomName=e.room,this._userName=e.userName,this._userId=e.userId,this._peers=[],this._serverUserList=[],this._state=l.IDLE,this._iceServers=[],this._config={}}var c="[ChatRoom] - ",d=function(e){n.debug_(c+p(e))},u=function(e){n.error_(c+p(e))},p=n.stringifyJSON,l={IDLE:1,ROOM_ENTERED:2,STOPPED:3},m=t.CHATPEER_STATE,f=s.prototype=Object.create(r.prototype);return f.setConfig=function(e){this._config=e},f.setIceServers=function(e){this._iceServers=e},f.enter=function(){d("enter()");var t=this;return t._state==l.ROOM_ENTERED?Promise.reject(a.WrongStateError("Already in room")):(e.registerListener("RoomMessage",t._onRoomMessage.bind(t)),e.enterRoom({roomName:this._roomName,userName:this._userName}).then(function(e){t._state=l.ROOM_ENTERED}))},f.leave=function(){d("leave()");var t=this;return e.removeEvent("RoomMessage"),e.leaveRoom({roomName:this._roomName}).then(function(){t.destroy(),t._state=l.STOPPED}).catch(function(e){return t.destroy(),t._state=l.STOPPED,u(e),Promise.reject(e)})},f.callUser=function(t){return d("callUser()"),e.callUser({userId:t,roomName:this._roomName}).catch(function(e){return u(e),Promise.reject(e)})},f.answerCall=function(t){d("answerCall()");var r=this;return e.answerCall({userId:t,roomName:this._roomName}).then(function(e){r._createChatPeer(!1,t,e.user_name,e.caller_peer_id,e.callee_peer_id)}).catch(function(e){return u(e),Promise.reject(e)})},f.declineCall=function(t){return d("declineCall()"),e.declineCall({userId:t,roomName:this._roomName}).catch(function(e){return u(e),Promise.reject(e)})},f.hangUpCall=function(t){d("hangUpCall()");var r=this;return e.hangUpCall({userId:t,roomName:this._roomName}).then(function(){r._destroyPeer(t),r._createPublicUserList()}).catch(function(e){return u(e),Promise.reject(e)})},f.getUsersCount=function(){return this._peers.length},f.destroy=function(){d("destroy()"),e.removeEvent("RoomMessage");for(var t=0;t<this._peers.length;t++)this._peers[t].destroy();return this._peers=[],Promise.resolve()},f._addEventPayload=function(e){return e=e||{},e.data=e.data||{},e.data.state=this._state,e},f._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},f._createChatPeer=function(e,t,r,n,a){d("_createChatPeer()");var s=new i(this._userName,this._userId,t,r,this._roomName);s.setIceServers(this._iceServers),s.addStream(o.getLocalMedias()[0].stream),s.setConfig(this._config),s.start(e,n,a),this._peers.push(s),this._bind(s)},f._destroyPeer=function(e){d("_destroyPeer()");var t=this._removePeerFromPeerList(e);this._unbind(t),t.destroy()},f._bind=function(e){e.on("RemoteStreamAdded",this._reemit.bind(this)),e.on("StateChanged",this._handlePeerState.bind(this))},f._unbind=function(e){e.removeEvent("RemoteStreamAdded"),e.removeEvent("StateChanged")},f._handlePeerState=function(e){switch(d("_handlePeerState: "+e.target.getPeerId()+" - state: "+e.data.state),e.data.state){case t.CHATPEER_STATE.INITIALIZED:case t.CHATPEER_STATE.SIGNALING:case t.CHATPEER_STATE.SIGNALLING_DONE:case t.CHATPEER_STATE.CALLING:case t.CHATPEER_STATE.NEGOTIATION_NEEDED:break;case t.CHATPEER_STATE.DISCONNECTED:this._destroyPeer(e.target.getRemoteUserId());break;case t.CHATPEER_STATE.FAILED:this._destroyPeer(e.target.getRemoteUserId());break;case t.CHATPEER_STATE.STOPPED:}this._createPublicUserList()},f._createPublicUserList=function(){d("_createPublicUserList()");for(var e,t,r,i,o=[],a=0;a<this._peers.length;a++)i={},e=this._peers[a],t=e.getState(),r=n.getKeyByValue(m,t).toLowerCase(),i.state=r,i.remoteUserName=e.getRemoteUserName(),i.remoteUserId=e.getRemoteUserId(),o.push(i);var s=this._serverUserList.filter(function(e){for(var t=0;t<o.length;t++)if(o[t].remoteUserId==e.remoteUserId)return!1;return!0}),c=s.concat(o).sort(function(e,t){return e.remoteUserName.toUpperCase()<t.remoteUserName.toUpperCase()?-1:e.remoteUserName.toUpperCase()>t.remoteUserName.toUpperCase()?1:0});return d("publicList: "+p(s)),d("peerList: "+p(o)),d("sortedList: "+p(c)),this.emit("RoomUpdate",{type:"room_update",data:{userlist:c}}),c},f._getPeerByRemoteUserId=function(e){d("_getPeerByRemoteUserId()");for(var t,r=0;r<this._peers.length;r++)if(t=this._peers[r],t.getRemoteUserId()===e)return t},f._removePeerFromPeerList=function(e){d("_removePeerFromPeerList()");for(var t,r=0;r<this._peers.length;r++)if(t=this._peers[r],t.getRemoteUserId()===e)return this._peers.splice(r,1),t},f._onRoomMessage=function(e){d("_onRoomMessage()");var t={};switch(e.type){case"room_update":d("room_update: "+p(e)),this._serverUserList=e.data.userlist,this._createPublicUserList();break;case"call_incoming":t.remoteUserId=e.user_id,t.remoteUserName=e.user_name,this.emit("RoomUpdate",{type:"call_incoming",data:t});break;case"call_declined":t.remoteUserName=e.data.user_name,t.remoteUserId=e.data.user_id,this.emit("RoomUpdate",{type:"call_declined",data:t});break;case"hang_up":this._destroyPeer(e.data.user_id),this._createPublicUserList();break;case"start_as_caller":this._createChatPeer(!0,e.user_id,e.user_name,e.caller_peer_id,e.callee_peer_id)}},s}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(11),r(14),r(3),r(9),r(4),r(18),r(2)],i=function(e,t,r,n,i,o,a){"use strict";function s(e,t,r,i,o){n.call(this),m(e)||p("ChatPeer: param userName must be a string",2),m(o)||p("ChatPeer: param room must be a string",2),f(t)||p("ChatPeer: param userId must be an integer",2),this._userName=e,this._userId=t,this._peerId=void 0,this._remoteUserName=i,this._remoteUserId=r,this._remotePeerId=void 0,this._room=o,this._pcClient=void 0,this._streams=[],this._startTime=null,this._iceServers=[],this._config={},this._state=g.IDLE,this._messageQueue=[],this._isCaller=!1,this._remoteStream=null,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._statsInterval=0,this._rtcStats=null}var c="[ChatPeer] - ",d=function(e){i.debug_(c+v(e))},u=function(e){i.warning_(c+v(e))},p=function(e){i.error_(c+v(e))},l=function(e){i.success_(c+v(e))},m=i.isString,f=i.isIntString,v=i.stringifyJSON,h=i.isArray,g=r.CHATPEER_STATE,_=s.prototype=Object.create(n.prototype);return _.setIceServers=function(e){this._iceServers=e},_.setConfig=function(e){this._config=e},_.getState=function(){return this._state},_.getPeerId=function(){return this._peerId},_.getRemoteUserId=function(){return this._remoteUserId},_.getRemoteUserName=function(){return this._remoteUserName},_.start=function(t,r,n){var i;this._isCaller=t,this._createPCClient(),this._isCaller?(this._peerId=r,this._remotePeerId=n):(this._peerId=n,this._remotePeerId=r),i="receiver_peer_"+this._peerId,e.registerListener(i,this._onServerMessage.bind(this)),this._isCaller?this._pcClient.startAsCaller(null):this._pcClient.startAsCallee(this._messageQueue),this._setState(g.INITIALIZED)},_.addStream=function(e){return d("addStream()"),e?2===this._streams.length?void u("[peer id: r "+this._peerId+"] stream count is already=2, we only support 2 streams/Chatpeer"):void(h(e)?this._streams=e:this._streams.push(e)):void p("[peer id: "+this._peerId+'] parameter "stream" must not be undefined')},_.enableStats=function(e,t){d("enableStats()"),this._statsEnabled="undefined"==typeof e||e,this._statsIntervalTime=t||1e3,this._rtcStats=null,this._statsEnabled&&(this._rtcStats=new o,this._rtcStats.on("ReceivedWebRTCStats",this._reemit.bind(this)))},_.destroy=function(){d("destroy()"),this._unbind(),this._closePCClient(),this._setState(g.STOPPED),this._remoteStream&&(a.removeMedia(this._remoteStream.id),this._remoteStream=null)},_._onServerMessage=function(t){var r=this;switch(t.type){case"sdp_message":r._pcClient&&r._pcClient.isStarted()?r._pcClient.setRemoteDescription(t.data).catch(function(e){return p("setRemoteDescription failed:",e),Promise.reject(e)}).then(function(){if(l("setRemoteDescription succeded"),!r._isCaller)return r._pcClient.doAnswer()}).catch(function(e){return p("doAnswer failed:",e),Promise.reject(e)}).then(function(t){if(!r._isCaller){l("doAnswer succeded "+t);var n={};return n.sender_peer=r._peerId,n.receiver_peer=r._remotePeerId,n.data=t,e.sendSignalingMessage(n).catch(function(e){p("sendSignalingMessage - "+e)})}}).catch(function(e){p("doAnswer failed:",e)}):r._messageQueue.push(t.data.sdp);break;case"ice_candidate":r._pcClient&&r._pcClient.isStarted()?r._pcClient.addIceCandidate(t.data.candidate):r._messageQueue.push(t.data.candidate);break;case"server_error":r._setState(g.FAILED),console.error("server error: ",t.error);break;default:console.log("unknown message:",t)}},_._addEventPayload=function(e){return e=e||{},e.target=this,e.data=e.data||{},e.data.state=this._state,e.data.message=i.getKeyByValue(g,this._state).toLowerCase(),e.data.text=e.data.message,e},_._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},_._collectRtcStats=function(){var e=this;clearInterval(e._statsInterval),this._statsInterval=setInterval(function(){return e._pcClient?void e._pcClient.getStats().then(function(t){e._rtcStats||(e._rtcStats=new o),e._rtcStats.putReport(t)}).catch(function(t){p("[peer id: "+e._peerId+"] "+t)}):void clearInterval(e._statsInterval)},this._statsIntervalTime)},_._stopCollectRtcStats=function(){this._statsInterval&&(d("stopping rtc stats collection"),clearInterval(this._statsInterval))},_._getPeerConnectionConfig=function(){d("_getPeerConnectionConfig()");var e={iceServers:this._iceServers,iceTransports:"all"},t={optional:[],mandatory:[]};t.optional.push({googCpuOveruseDetection:!1}),t.optional.push({RtpDataChannels:!1});var r={mediaConstraints:{audio:!0,video:!0},sdpPatches:this._config.sdpPatches,peerConnectionConfig:e,peerConnectionConstraints:t,send:!0,receive:!0,videoSendCodec:this._config.codecs.videoCodec||"H264",videoRecvCodec:this._config.codecs.videoCodec||"H264",videoSendBitrate:this._config.bitrates.videoSendBitrate||0,videoSendInitialBitrate:this._config.bitrates.videoSendInitialBitrate||0};return r},_._createPCClient=function(){if(d("_createPCClient()"),this._pcClient)return void d("[peer id:  "+this._peerId+"] PeerConnection still alive, do not create!");try{this._pcClient=new t(this._getPeerConnectionConfig(),this._startTime),this._bind();for(var e=0;e<this._streams.length;e++)this._pcClient.addStream(this._streams[e]);l("Created PeerConnectionClient")}catch(e){p("[peer id: "+this._peerId+"] Create PeerConnection exception: "+e.message),this.emitSimple("CreatePeerConnectionClientError")}},_._bind=function(){d("_bind()"),this._pcClient.on("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.on("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.on("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.on("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.on("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},_._unbind=function(){d("_unbind()"),this._pcClient.off("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.off("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.off("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.off("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.off("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.off("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},_._setState=function(e){if(d("_setState() - "+e),e===this._state)return void d("No state change");if(this._state!==g.CALLING||e!==g.SIGNALING&&e!==g.SIGNALLING_DONE){var t,r=this._state;this._state=e,d("STATE: "+i.getKeyByValue(g,r)+" -> "+i.getKeyByValue(g,this._state)),t=this._addEventPayload({}),this.emit("StateChanged",t)}},_._onIceConnectionStateChange=function(e){switch(d("ice connection state: "+e.data.state),e.data.state){case"new":case"checking":this._setState(g.SIGNALING);break;case"connected":case"completed":this._setState(g.SIGNALLING_DONE),this._statsEnabled&&this._pcClient&&this._collectRtcStats();break;case"failed":this._setState(g.FAILED),this._statsEnabled&&this._pcClient&&this._stopCollectRtcStats();break;case"disconnected":this._setState(g.DISCONNECTED);break;case"closed":}},_._onNegotiationNeeded=function(e){u("NegotiationNeeded event has been fired")},_._onEndOfLocalCandidates=function(e){d("_onEndOfLocalCandidates()")},_._onRemoteStreamAdded=function(e){d("_onRemoteStreamAdded()");var t=this;if(!this._remoteStream){this._remoteStream=e.data.stream;var r={stream:this._remoteStream,kind:"remote",remoteUserId:this._remoteUserId,remoteUserName:this._remoteUserName};a.addRemoteMedia(r).then(function(){t._setState(g.CALLING),t.emitSimple(e.name,{stream:t._remoteStream.id})}).catch(function(e){var t="Failed to add remote media to MediaController list of medias:"+e;p(t)})}},_._onRemoteStreamRemoved=function(e){d("_onRemoteStreamRemoved()"),this._remoteStream&&(a.removeMedia(this._remoteStream.id),this._remoteStream=null)},_._closePCClient=function(){if(d("_closePCClient()"),!this._pcClient)return void u("No PeerConenctionClient");var e,t,r=this._streams;for(e=0,t=r.length;e<t;++e)try{this._pcClient.removeStream(r[e])}catch(e){p("[peer id: "+this._peerId+"] Could not remove stream from peerconnectionclient")}this._pcClient.close(),this._streams=null,this._pcClient=null},_._sendMessageToPeer=function(t){d("_sendMessageToPeer()");var r={};if(!this._remotePeerId){var n="Trying to send message, but no remote peer id set! This should not happen!";return p(n),Promise.reject(n)}if(!this._peerId){var n="Trying to send message, but no peer id set! This should not happen!";return p(n),Promise.reject(n)}return r.sender_peer=this._peerId,r.receiver_peer=this._remotePeerId,r.data=t,e.sendSignalingMessage(r).catch(function(e){return p("_sendMessageToPeer - "+e),Promise.reject(e)})},_._onSignalingMessage=function(e){return d("_onSignalingMessage - "+v(e.data)),this._remotePeerId?void this._sendMessageToPeer(e.data).then(function(){}).catch(function(e){p(e)}):void p("Trying to send message, but no remote peer set! This should not happen!")},s}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n,i;n=[r(9),r(4)],i=function(e,t){"use strict";function r(){e.call(this),this._bufferSize=1024,this._numInputChannels=2,this._numOutputChannels=2,this._channels=[],this._microphone=null,this._scriptProcessorNode=null,this.active=!1;var t=window.AudioContext||window.webkitAudioContext;c(t)?this._audioContext=new t:(a("no browser audio context found"),this._audioContext=null)}function n(e,t){e=e||{},s(t)||a("AudioChannel: param audioProcess must be of type object",2),this._audioProcess=t,this._level=0,this._maxLevel=0,this._oldLevel=0,this._id=e.id,this._name=e.name,this._channelData=void 0}var i=Math.max,o=Math.sqrt,a=t.error_,s=t.isObject,c=t.isFunction,d=r.prototype=Object.create(e.prototype);return d.connect=function(e,t){var r,i;for(t=t||{bufferSize:1024,numInputChannels:2,numOutputChannels:2,channels:[{name:"left",id:0},{name:"right",id:1}]},this._bufferSize=t.bufferSize||1024,this._numInputChannels=t.numInputChannels||2,this._numOutputChannels=t.numOutputChannels||2,this._channels=[],r=0,i=t.channels.length;r<i;r++)this._channels.push(new n(t.channels[r],this));if(!e)return void this.emitSimple("AudioNoStream",{stream:e});var o=e.getAudioTracks();if(o&&o.length>0){var a=this._scriptProcessorNode=this._audioContext.createScriptProcessor(this._bufferSize,this._numInputChannels,this._numOutputChannels);this._microphone=this._audioContext.createMediaStreamSource(e),this._microphone.connect(a),a.connect(this._audioContext.destination),a.onaudioprocess=this._onAudioProcess.bind(this),this.active=!0}else this.emitSimple("AudioNoTrack",{stream:e})},d.reset=function(){this.active=!1,this._microphone=null,this._scriptProcessorNode=null},d._onAudioProcess=function(e){if(this.active){var t,r,n=e.inputBuffer,i=this._channels,o=this;setTimeout(function(){var e=[];for(t=0,r=i.length;t<r;t++)i[t].update(n.getChannelData(t)),e.push(i[t].getChannelData());o.emitSimple("AudioProcess",{channels:e})},0)}},n.prototype.update=function(e){this._channelData=e;var t,r=0,n=e.length;for(t=0;t<n;t++)r+=e[t]*e[t];this._level=o(r/(n||1)),this._maxLevel=i(this._level,this._maxLevel),this._oldLevel=i(this._level,this._oldLevel-.008)},n.prototype.getChannelData=function(){return{maxLevel:this._maxLevel,oldLevel:this._oldLevel,avgLevel:this._level,name:this._name,id:this._id}},r}.apply(t,n),!(void 0!==i&&(e.exports=i))}]);